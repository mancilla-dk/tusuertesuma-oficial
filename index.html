<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tu Suerte Suma | Sorteos Profesionales</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

        <style>
        /* ==========================================================================
           1. ESTILOS BASE Y TEMAS (NEÓN VIBRANTE - SIN NEGRO)
           ========================================================================== */
        :root {
            /* TEMA DEFAULT (Esmeralda Neón) */
            --primary: #00ff88; 
            --primary-dark: #00b359; 
            --accent: #fff; 
            --dark: #004d33; /* Verde muy oscuro para textos, no negro */
            
            /* DEGRADADO FUTURISTA: Verde Profundo -> Verde Neón -> Blanco Hielo */
            --bg-elegant: linear-gradient(135deg, #003322 0%, #009966 60%, #ccffee 100%);
            
            --nav-gradient: linear-gradient(90deg, #004d33 0%, #00b359 100%);
            --glass-bg: rgba(0, 30, 20, 0.4); /* Cristal tintado suave */
            --card-glass: rgba(255, 255, 255, 0.9);
            --text-color: #fff;
            --neon-glow: 0 0 15px #00ff88;
            --sold-out: #ff1744; 
        }

        /* 2. Vino (Plasma Rojo) */
        body.theme-maroon { 
            --primary: #ff0055; --primary-dark: #cc0044; --accent: #ffcccc; --dark: #4d0019;
            --bg-elegant: linear-gradient(135deg, #4a001e 0%, #d9004c 60%, #ffcce0 100%);
            --nav-gradient: linear-gradient(90deg, #660022 0%, #ff0055 100%);
            --neon-glow: 0 0 15px #ff0055;
        }
        /* 3. Azul (Ciberpunk Cyan - LO QUE PEDISTE) */
        body.theme-blue { 
            --primary: #00ccff; --primary-dark: #0077ff; --accent: #e0ffff; --dark: #002244;
            /* Azul Fuerte -> Azul Neón -> Semi Blanco */
            --bg-elegant: linear-gradient(135deg, #001a4d 0%, #0066ff 50%, #00ccff 80%, #f0faff 100%);
            --nav-gradient: linear-gradient(90deg, #003366 0%, #00ccff 100%);
            --neon-glow: 0 0 15px #00ccff;
        }
        /* 4. Rojo (Fuego Láser) */
        body.theme-red { 
            --primary: #ff3300; --primary-dark: #cc2900; --accent: #ffffcc; --dark: #4d1400;
            --bg-elegant: linear-gradient(135deg, #4d0f00 0%, #ff4500 60%, #ffe6cc 100%);
            --nav-gradient: linear-gradient(90deg, #991f00 0%, #ff3300 100%);
            --neon-glow: 0 0 15px #ff3300;
        }
        /* 5. Rosa (Vaporwave) */
        body.theme-pink { 
            --primary: #ff00cc; --primary-dark: #b3008f; --accent: #ffe0fa; --dark: #4d003d;
            --bg-elegant: linear-gradient(135deg, #4d0040 0%, #d600b8 60%, #ffccfa 100%);
            --nav-gradient: linear-gradient(90deg, #80006a 0%, #ff00cc 100%);
            --neon-glow: 0 0 15px #ff00cc;
        }
        /* 6. Naranja (Atardecer Digital) */
        body.theme-orange { 
            --primary: #ff8800; --primary-dark: #cc6d00; --accent: #ffefcc; --dark: #4d2900;
            --bg-elegant: linear-gradient(135deg, #4d2600 0%, #ff6600 60%, #ffebcc 100%);
            --nav-gradient: linear-gradient(90deg, #993300 0%, #ff8800 100%);
            --neon-glow: 0 0 15px #ff8800;
        }
        /* 7. Dorado (Lujo Metálico) */
        body.theme-yellow { 
            --primary: #ffcc00; --primary-dark: #b38f00; --accent: #fffff0; --dark: #4d3d00;
            --bg-elegant: linear-gradient(135deg, #4d3900 0%, #ffbf00 60%, #fffbe6 100%);
            --nav-gradient: linear-gradient(90deg, #997300 0%, #ffcc00 100%);
            --neon-glow: 0 0 15px #ffcc00;
        }
        /* 8. Púrpura (Galaxia Ultra) */
        body.theme-purple {
            --primary: #aa00ff; --primary-dark: #7700b3; --accent: #eaddff; --dark: #2a0040;
            --bg-elegant: linear-gradient(135deg, #1f0033 0%, #7b00ff 60%, #e0ccff 100%);
            --nav-gradient: linear-gradient(90deg, #3d0066 0%, #aa00ff 100%);
            --neon-glow: 0 0 15px #aa00ff;
        }
        /* 9. Negro (Silver Tech - No negro total) */
        body.theme-black {
            --primary: #999999; --primary-dark: #333333; --accent: #ffffff; --dark: #111111;
            /* Gris Titanio -> Plata -> Blanco */
            --bg-elegant: linear-gradient(135deg, #1a1a1a 0%, #4d4d4d 60%, #d9d9d9 100%);
            --nav-gradient: linear-gradient(90deg, #1a1a1a 0%, #666666 100%);
            --neon-glow: 0 0 15px #ffffff;
            --card-glass: rgba(255,255,255, 0.95);
        }
        /* 10. Turquesa (Agua Neón) */
        body.theme-teal {
            --primary: #00e5ff; --primary-dark: #008fa3; --accent: #ccfaff; --dark: #00333d;
            --bg-elegant: linear-gradient(135deg, #00262e 0%, #00acc1 60%, #ccf9ff 100%);
            --nav-gradient: linear-gradient(90deg, #004d57 0%, #00e5ff 100%);
            --neon-glow: 0 0 15px #00e5ff;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', system-ui, sans-serif; }
        
        body { 
            background: var(--bg-elegant); 
            color: #fff; /* Texto blanco por defecto para resaltar sobre color */
            line-height: 1.5; 
            min-height: 100vh; 
            background-attachment: fixed; 
            transition: background 0.5s ease; 
        }

        /* ==========================================================================
           2. SKELETON LOADER (ESTILO DARK TECH QUE TE GUSTÓ)
           ========================================================================== */
        #skeleton-loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            /* Mantengo el negro tecnológico solo para la carga */
            background: radial-gradient(circle, #1a1a1a 0%, #000000 100%);
            z-index: 99999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 0.5s ease;
        }
        .sk-spinner {
            width: 70px; height: 70px; 
            border: 4px solid rgba(255,255,255,0.1); 
            border-top: 4px solid var(--primary); 
            border-radius: 50%;
            animation: spin 0.8s linear infinite; margin-bottom: 20px;
            box-shadow: 0 0 20px var(--primary); /* Glow del color del tema */
        }
        .sk-text { 
            color: var(--primary); font-weight: 800; text-transform: uppercase; 
            letter-spacing: 4px; animation: pulse 1.5s infinite; font-size: 1rem;
            text-shadow: 0 0 10px var(--primary);
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }

        /* ==========================================================================
           3. UI GENERAL Y NAVEGACIÓN
           ========================================================================== */
        .admin-only, .btn-edit-floating, .admin-controls, .admin-clean-wrapper, .nav-admin-row { 
            display: none !important; 
        }
        body.is-admin .admin-only { display: inline-block !important; }
        body.is-admin .btn-edit-floating { display: flex !important; }
        body.is-admin .admin-controls { display: block !important; }
        
        body.is-admin .admin-clean-wrapper { 
            display: flex !important; justify-content: center !important; 
            align-items: center; width: 100%; margin: 20px 0;
        }
        body.is-admin .nav-admin-row { 
            display: flex !important; justify-content: center !important; 
            width: 100%; padding: 5px 0; background: rgba(0,0,0,0.5);
            border-bottom: 1px solid var(--accent);
        }

        /* --- NAVEGACIÓN (Barra) --- */
        nav { 
            background: var(--nav-gradient); 
            position: sticky; top: 0; z-index: 10000; padding: 10px 0; 
            border-bottom: 1px solid rgba(255,255,255,0.3); 
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); 
            backdrop-filter: blur(5px); 
        }
        .nav-structure { max-width: 1100px; margin: 0 auto; display: flex; flex-direction: column; align-items: center; position: relative; }
        .nav-top-row { display: flex; justify-content: center; align-items: center; width: 100%; gap: 40px; position: relative; }
        
        .nav-floating-left { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); display: flex; gap: 10px; }
        .nav-floating-right { position: absolute; right: 20px; top: 50%; transform: translateY(-50%); display: flex; gap: 10px; }
        
        .nav-link-side { 
            color: white; text-decoration: none; font-weight: 700; text-transform: uppercase; 
            font-size: 0.9rem; cursor: pointer; transition: 0.3s; position: relative; 
            text-shadow: 0 0 5px rgba(0,0,0,0.5);
        }
        .nav-link-side::after { content: ''; position: absolute; width: 0; height: 2px; bottom: -2px; left: 0; background-color: white; transition: width 0.3s; box-shadow: 0 0 10px white; }
        .nav-link-side:hover::after { width: 100%; }
        .nav-link-side:hover { transform: scale(1.05); }
        
        .nav-logo-img { height: 95px; width: auto; cursor: pointer; transition: transform 0.3s; filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.6)); }
        .nav-logo-img:hover { transform: scale(1.05); filter: drop-shadow(0 0 15px white); }
        .logo-container { display: flex; flex-direction: column; align-items: center; justify-content: center; }
        
        .nav-bottom-row { margin-top: 10px; }
        .nav-link-home { color: white; font-weight: 900; text-transform: uppercase; font-size: 1.2rem; letter-spacing: 3px; cursor: pointer; text-shadow: 0 0 15px var(--accent); }

        .social-btn { color: white; font-size: 1.2rem; transition: all 0.3s ease; text-decoration: none; display: flex; align-items: center; justify-content: center; width: 35px; height: 35px; border-radius: 50%; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.4); }
        .social-btn:hover { background: white; color: var(--primary-dark); transform: scale(1.1); box-shadow: 0 0 15px white; }
        
        @media (max-width: 850px) {
            .nav-floating-right { position: static; transform: none; margin-top: 10px; }
            .nav-floating-left { position: static; transform: none; margin-bottom: 10px; }
            .nav-top-row { flex-wrap: wrap; gap: 15px; justify-content: center; }
        }
        @media (max-width: 600px) { 
            .nav-top-row { justify-content: space-between; padding: 0 15px; gap: 10px; } 
            .nav-link-side { font-size: 0.75rem; text-align: center; max-width: 80px; } 
            .nav-logo-img { height: 75px; } 
            .nav-floating-right, .nav-floating-left { display: none; }
        }

        /* --- COMPONENTES UI --- */
        .section-title { 
            text-align: center; color: white; font-size: 1.8rem; margin-bottom: 1rem; 
            text-transform: uppercase; font-weight: 900; line-height: 1.2; 
            text-shadow: 0 0 10px var(--primary-dark); letter-spacing: 1px; 
        }
        
        .btn-action { 
            background: linear-gradient(135deg, var(--primary), var(--primary-dark)); 
            color: white; padding: 12px 25px; text-decoration: none; 
            border-radius: 30px; font-weight: 900; cursor: pointer; border: 2px solid white; 
            display: inline-block; transition: 0.3s; box-shadow: 0 5px 15px rgba(0,0,0,0.2); 
            text-transform: uppercase; letter-spacing: 1px; font-size: 0.9rem;
        }
        .btn-action:hover { 
            background: white; color: var(--primary-dark); transform: translateY(-3px); 
            box-shadow: 0 0 20px white; border-color: var(--primary);
        }
        
        .page-view { display: none; animation: fade 0.5s; padding-bottom: 80px; }
        @keyframes fade { from {opacity:0; transform: translateY(20px);} to {opacity:1; transform: translateY(0);} }

        /* --- BOTÓN PANEL --- */
        .btn-panel-rectangular { 
            display: none; 
            background: rgba(0,0,0,0.5); 
            color: white; padding: 10px 30px; border-radius: 4px; font-weight: 800; text-transform: uppercase; cursor: pointer; 
            border: 1px solid white; box-shadow: 0 0 10px rgba(255,255,255,0.3); font-size: 0.95rem; 
            letter-spacing: 1px; transition: transform 0.2s, box-shadow 0.2s; text-decoration: none; 
            align-items: center; gap: 10px; 
        }
        .btn-panel-rectangular:hover { transform: scale(1.05); box-shadow: 0 0 20px white; background: white; color: black; }
        body.is-admin .btn-panel-rectangular { display: inline-flex !important; }

        /* --- HERO & HOME --- */
        .hero { background: transparent; color: white; text-align: center; padding: 2rem 1rem 1rem; display: flex; flex-direction: column; align-items: center; }
        @keyframes urgentPulse { 0% { text-shadow: 0 0 20px white; transform: scale(1); } 50% { text-shadow: 0 0 40px var(--primary), 0 0 10px white; transform: scale(1.03); } 100% { text-shadow: 0 0 20px white; transform: scale(1); } }
        .urgent-title { font-size: 2.8rem; font-weight: 900; color: white; margin-bottom: 5px; animation: urgentPulse 2s infinite ease-in-out; text-transform: uppercase; letter-spacing: 3px; line-height: 1; max-width: 800px; }
        .short-desc { font-size: 1.2rem; max-width: 800px; margin-bottom: 1.5rem; color: white; text-shadow: 0 1px 3px rgba(0,0,0,0.5); font-weight: 500; }
        
        .home-carousel-wrapper { position: relative; width: 100%; max-width: 1000px; margin: 0 auto; }
        .home-events-container { display: flex; overflow-x: auto; scroll-behavior: smooth; -webkit-overflow-scrolling: touch; gap: 20px; padding: 20px 5px; width: 100%; white-space: nowrap; scrollbar-width: none; }
        .home-events-container::-webkit-scrollbar { display: none; }

        .carousel-nav-btn {
            position: absolute; top: 50%; transform: translateY(-50%);
            background: white; color: var(--primary-dark);
            border: none; width: 40px; height: 40px;
            border-radius: 50%; font-size: 1.2rem; cursor: pointer; z-index: 20;
            display: none; align-items: center; justify-content: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); transition: all 0.3s;
        }
        .carousel-nav-btn:hover { transform: translateY(-50%) scale(1.2); box-shadow: 0 0 20px white; }
        .carousel-nav-btn.prev { left: -15px; }
        .carousel-nav-btn.next { right: -15px; }

        @media(max-width: 768px) {
            .carousel-nav-btn.prev { left: 5px; }
            .carousel-nav-btn.next { right: 5px; }
        }

               /* --- SECCIONES (GLASSMISM COLORIDO) --- */
                .bio-section, .evidence-section, .faq-section { 
            background: var(--glass-bg); max-width: 950px; margin: 0 auto 2rem; 
            padding: 25px 8px; /* Padding lateral reducido drásticamente */
            border-radius: 15px; border: 1px solid rgba(255,255,255,0.1); 
            box-shadow: 0 10px 40px rgba(0,0,0,0.4); 
            text-align: center; 
            color: #f0f0f0; backdrop-filter: blur(10px);
        }

        .bio-header { display: flex; flex-direction: column; align-items: center; margin-bottom: 1.5rem; }
        .bio-logo-small { height: 70px; width: auto; margin-bottom: 10px; filter: drop-shadow(0 0 5px white); }
        
                .bio-title-main { 
            font-size: clamp(1rem, 7vw, 1.8rem); /* Se hace pequeña automáticamente para caber */
            font-weight: 900; color: var(--primary); text-transform: uppercase; margin: 0 auto; 
            white-space: nowrap; /* Fuerza una sola línea */
            width: 100%; overflow: hidden; text-overflow: ellipsis;
            text-align: center; letter-spacing: 1px; text-shadow: 0 2px 4px rgba(0,0,0,0.5); 
        }

        
        .bio-subtitle-editable { 
            color: #ccc; font-weight: 700; font-size: 1.1rem; margin-top: 5px; 
            min-height: 20px; display: block; font-style: italic; text-align: center; 
        }
        
                .bio-text p { 
            margin: 0 auto 12px auto; color: #e0e0e0; font-size: 1rem; line-height: 1.5; 
            text-align: justify; /* Justificado para llenar a lo ancho */
            text-align-last: center; /* Última línea centrada para estética */
            padding: 0 2px; /* Margen mínimo en bordes */
            width: 100%;
        }

        
        .bio-highlight { 
            font-weight: 800; color: var(--accent); font-size: 1.1rem; 
            display: inline-block; margin-top: 20px; border-bottom: 1px solid var(--accent); 
        }

        .carousel-container { width: 100%; max-width: 900px; margin: 0 auto 2rem; position: relative; border-radius: 15px; overflow: hidden; border: 2px solid var(--primary); box-shadow: var(--neon-glow); background: black; display: none; }
        .carousel-slide img { width: 100%; height: 300px; object-fit: cover; display: block; }
        .c-btn { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.8); color: white; border: none; padding: 15px; cursor: pointer; font-size: 1.5rem; transition: 0.3s; z-index: 10; } .prev { left: 0; } .next { right: 0; }
        
        details { background: rgba(0,0,0,0.2); margin-bottom: 10px; border-radius: 5px; border: 1px solid rgba(255,255,255,0.1); }
        summary { padding: 15px; cursor: pointer; font-weight: 700; color: var(--accent); list-style: none; display: flex; justify-content: space-between; align-items: center; text-transform: uppercase; font-size: 0.9rem; }
        summary::after { content: '+'; font-size: 1.5rem; color: var(--primary); }
        details[open] summary::after { content: '-'; color: var(--primary-dark); }
        details[open] { border-left: 3px solid var(--primary); background: rgba(0,0,0,0.4); }
        .faq-ans { padding: 15px; color: #ddd; text-align: justify; font-size: 0.95rem; line-height: 1.6; border-top: 1px solid rgba(255,255,255,0.1); }

        /* --- CARDS & GRID (TARJETAS BLANCAS/LUMINOSAS) --- */
        .events-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; padding: 20px; max-width: 1000px; margin: 0 auto; }
        .event-card { 
            background: var(--card-glass); /* Fondo casi blanco */
            border-radius: 20px; overflow: hidden; box-shadow: 0 10px 25px rgba(0,0,0,0.15); 
            transition: transform 0.3s, box-shadow 0.3s; position: relative; display: inline-flex; flex-direction: column; cursor: pointer; 
            width: 280px; flex-shrink: 0; white-space: normal; vertical-align: top; margin: 0 auto; border: none;
        }
        .event-card:hover { transform: translateY(-10px); box-shadow: 0 15px 30px rgba(0,0,0,0.25); }
        .event-img { width: 100%; height: 180px; object-fit: cover; }
        .event-body { padding: 20px; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .event-title { font-size: 1.3rem; font-weight: 800; color: #333; margin-bottom: 5px; line-height: 1.2; text-transform: uppercase; letter-spacing: 0.5px; }
        .event-desc { font-size: 0.95rem; color: #666; margin-bottom: 15px; flex-grow: 1; }
        .event-price { font-size: 1.6rem; color: var(--primary-dark); font-weight: 900; }
        
        .btn-edit-floating { position: absolute; top: 10px; right: 10px; background: white; color: var(--primary-dark); border: none; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; cursor: pointer; z-index: 5; transition: all 0.3s ease; box-shadow: 0 5px 10px rgba(0,0,0,0.2); }
        .btn-edit-floating:hover { transform: scale(1.1) rotate(15deg); color: var(--primary); }

        /* --- TICKETS & SELECCION --- */
        .ticket-header { background: rgba(255,255,255,0.95); padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); max-width: 800px; margin: 0 auto 20px auto; text-align: center; backdrop-filter: blur(10px); }
        #header-title { text-align: center; color: #222; font-size: 2rem; font-weight: 900; text-transform: uppercase; margin: 15px auto 10px; width: 100%; letter-spacing: 1px; }
        #header-desc { color: #555; font-size: 1.05rem; margin: 10px auto 20px; max-width: 90%; text-align: justify; line-height: 1.7; padding: 0 5px; }
        .leyenda { display: flex; justify-content: center; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
        .badge { padding: 8px 15px; border-radius: 30px; font-size: 0.9rem; font-weight: bold; display: flex; align-items: center; gap: 5px; background: #f0f0f0; border: 1px solid #ddd; color: #555; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(60px, 1fr)); gap: 12px; max-width: 800px; margin: 0 auto; padding-bottom: 80px; }
        .grid-container.locked { pointer-events: none; filter: grayscale(1); opacity: 0.8; position: relative; }

        .ticket { background: white; border: none; border-radius: 12px; padding: 15px 0; font-weight: 800; font-size: 1.2rem; cursor: pointer; transition: all 0.2s; position: relative; box-shadow: 0 4px 6px rgba(0,0,0,0.1); text-align: center; color: #444; }
        .ticket:hover { transform: translateY(-5px); box-shadow: 0 8px 15px rgba(0,0,0,0.15); z-index: 2; }
        .ticket.disponible { color: #2ecc71; border-bottom: 4px solid #2ecc71; }
        .ticket.apartado { background-color: #fff3cd; color: #856404; border-bottom: 4px solid #ffc107; }
        .ticket.pagado { background-color: #f8d7da; color: #721c24; border-bottom: 4px solid #dc3545; opacity: 0.8; }
        /* TICKET SELECCIONADO = NEGRO TECH */
        .ticket.selected { background-color: #1a1a1a; color: white; transform: scale(1.15); box-shadow: 0 10px 25px rgba(0,0,0,0.3); border-bottom: 4px solid var(--accent); z-index: 5; }
        .ticket.range-text { font-size: 0.9rem; padding: 18px 0; }

        .selection-bar { position: fixed; bottom: -100px; left: 0; width: 100%; background: #1a1a1a; color: white; padding: 20px; display: flex; justify-content: space-between; align-items: center; transition: bottom 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 1000; border-top: 4px solid var(--primary); box-shadow: 0 -10px 30px rgba(0,0,0,0.3); }
        .selection-bar.active { bottom: 0; }
        .selection-info { font-size: 1.3rem; font-weight: bold; }

        /* --- ADMIN CONTROLS --- */
        .admin-controls { background: #fff; border-top: 6px solid var(--primary); box-shadow: 0 10px 30px rgba(0,0,0,0.15); padding: 25px; margin: 25px auto; border-radius: 15px; max-width: 900px; color: #333; text-align: left; }
        .admin-title { color: #222; font-weight: 800; border-bottom: 2px solid #f0f0f0; padding-bottom: 15px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; font-size: 1.2rem; }
        .admin-form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .form-group { display: flex; flex-direction: column; }
        .form-group label { font-size: 0.85rem; font-weight: 700; color: #555; margin-bottom: 8px; text-transform: uppercase; }
        .form-control { padding: 12px; border: 2px solid #eee; border-radius: 8px; font-size: 1rem; width: 100%; transition: 0.3s; background: #f9f9f9; }
        .form-control:focus { border-color: var(--primary); background: white; outline: none; }
        @media(max-width:600px) { .admin-form-grid, .bank-row-inputs { grid-template-columns: 1fr; } }
        
        .bank-edit-grid { display: grid; grid-template-columns: 1fr; gap: 10px; border-bottom:1px solid #eee; padding-bottom:15px; margin-bottom:15px; }
        .bank-row-inputs { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .switch { position: relative; display: inline-block; width: 45px; height: 24px; margin-right: 10px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        input:checked + .slider { background-color: var(--primary); }
        input:checked + .slider:before { transform: translateX(21px); }

        /* --- MODALES --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 12000; display: none; justify-content: center; align-items: center; overflow-y: auto; padding: 20px 0; backdrop-filter: blur(8px); }
        .modal-content { background: white; padding: 30px; border-radius: 20px; width: 90%; max-width: 450px; box-shadow: 0 20px 50px rgba(0,0,0,0.3); animation: fadeIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); text-align: center; color: #333; margin: 20px auto; position: relative; max-height: 85vh; overflow-y: auto; border: none; }
        .close-btn { position: sticky; top: 0; float: right; font-size: 2rem; cursor: pointer; color: #ff5252; background: white; border-radius: 50%; width: 40px; height: 40px; line-height: 40px; text-align: center; z-index: 10; margin-top: -15px; margin-right: -15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .admin-detail-row { display: flex; justify-content: space-between; border-bottom: 1px solid #f0f0f0; padding: 12px 0; font-size: 0.95rem; }
        .admin-detail-label { font-weight: bold; color: #777; }
        .admin-detail-value { font-weight: 800; color: #333; text-align: right; }

                /* --- BANCOS & CARDS (OPTIMIZADO) --- */
        .cards-grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 25px; margin-top: 2rem; width: 100%; }
        .bank-card { 
            width: 320px; height: 180px; border-radius: 20px; 
            /* REEMPLAZO: Menos padding para subir contenido */
            padding: 15px 20px 20px 20px; 
            color: white; position: relative; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.2); display: flex; flex-direction: column; justify-content: space-between; 
            transition: transform 0.3s, box-shadow 0.3s; display: none; font-family: 'Courier New', monospace; 
            text-shadow: 0 1px 2px rgba(0,0,0,0.3); overflow: hidden; border: none;
        }

        .bank-card:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0,0,0,0.3); }
        .bank-card.visible { display: flex; }
        .card-logo-img { height: 35px; max-width: 90px; object-fit: contain; filter: drop-shadow(0 0 2px rgba(255,255,255,0.8)); }
        .card-logo-bank-icon { width: 40px; height: 40px; object-fit: contain; }
        .card-bbva { background: linear-gradient(135deg, #004481 0%, #002a52 100%); }
        .card-azteca { background: linear-gradient(135deg, #10b981 0%, #064e3b 100%); }
        .card-mp { background: linear-gradient(135deg, #009EE3 0%, #005F8F 100%); }
        .card-oxxo { background: linear-gradient(135deg, #ffc107 0%, #e61b1b 100%); color: white; }
        .card-banorte { background: linear-gradient(135deg, #eb0029 0%, #b1001f 100%); }
        .card-banamex { background: linear-gradient(135deg, #0056b3 0%, #002a52 100%); }
        .card-top { display: flex; justify-content: space-between; align-items: flex-start; }
        
        .card-number { 
            /* REEMPLAZO: Letra más pequeña y margen reducido para subir */
            font-size: 1rem; letter-spacing: 1px; text-align: center; font-weight: bold; margin: 5px 0; 
            background: rgba(0,0,0,0.15); padding: 8px; border-radius: 8px; display: flex; align-items: center; 
            justify-content: center; gap: 10px; white-space: nowrap; backdrop-filter: blur(2px);
        }
        
        .card-bottom { 
            display: flex; 
            justify-content: space-between; 
            align-items: flex-end; 
            width: 100%;
            margin-top: auto; 
        }
        
        .card-corner-left { text-align: left; flex: 1; }
        .card-corner-right { text-align: right; flex: 1; }

        .card-label { 
            font-size: 0.6rem; opacity: 0.9; display: block; color: #fff; 
            text-transform: uppercase; letter-spacing: 1px; margin-bottom: 2px; font-weight: 600;
        }
        
        .card-holder {
            /* REEMPLAZO: Letra reducida para evitar saltos de línea */
            font-size: 0.75rem; 
            font-weight: bold; text-transform: uppercase; white-space: nowrap;
            overflow: hidden; text-overflow: ellipsis; max-width: 170px;
        }

                /* --- AJUSTE TARJETAS: ESQUINAS PERFECTAS --- */
        .card-bottom { 
            display: flex; 
            justify-content: space-between; /* Empuja uno a cada lado */
            align-items: flex-end; 
            width: 100%;
            margin-top: auto; /* Asegura que se vaya al fondo */
        }
        
        /* Contenedor Izquierdo (Titular) */
        .card-corner-left { 
            text-align: left; 
            flex: 1; /* Toma el espacio disponible */
        }
        
        /* Contenedor Derecho (Banco) */
        .card-corner-right { 
            text-align: right; 
            flex: 1; 
        }

        .card-label { 
            font-size: 0.65rem; 
            opacity: 0.9; 
            display: block; 
            color: #fff; 
            text-transform: uppercase; 
            letter-spacing: 1.5px; 
            margin-bottom: 2px;
            font-weight: 600;
        }
        
        .card-holder {
            font-size: 0.9rem; /* Un poco más grande para legibilidad */
            font-weight: bold;
            text-transform: uppercase;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 160px; /* Evita que el nombre largo rompa la tarjeta */
        }

        .copy-btn { 
            background: white; border: none; color: #333; padding: 5px 12px; border-radius: 20px; 
            cursor: pointer; font-size: 0.7rem; font-weight: 800; text-shadow: none; 
            box-shadow: 0 3px 6px rgba(0,0,0,0.1); white-space: nowrap;
        }
        .copy-btn:hover { transform: scale(1.1); box-shadow: 0 5px 10px rgba(0,0,0,0.2); }

                             /* --- VIRTUAL TICKET (ESTILO PRO: DARK NEÓN & GOLD) --- */
        .virtual-ticket-card { 
            background: #050505; /* Fondo casi negro puro */
            border: 2px solid #00ff88; /* Borde Verde Neón */
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3); /* Resplandor suave */
            padding: 25px 20px; 
            border-radius: 20px; 
            text-align: center; 
            position: relative; 
            width: 95%; 
            max-width: 380px; 
            margin: 0 auto; 
            display: flex; 
            flex-direction: column; 
            gap: 10px;
        }
        
        .vt-header-group {
            display: flex; align-items: center; justify-content: center;
            gap: 15px; margin-bottom: 10px; padding-bottom: 15px;
            border-bottom: 1px dashed rgba(255,255,255,0.15);
        }

        .vt-logo { height: 55px; width: auto; filter: drop-shadow(0 0 2px white); }
        .vt-text-col { text-align: left; }
        
        .vt-congrats { 
            font-size: 1.3rem; font-weight: 900; color: #fff; 
            line-height: 1; text-transform: uppercase; letter-spacing: 0.5px;
        }
        .vt-msg { font-size: 0.85rem; color: #00ff88; font-weight: bold; margin-top: 4px; }

        /* FORZAR OCULTAR IMAGEN DEL EVENTO */
        .vt-event-img, #vt-link-img { display: none !important; }
        
        /* Contenedor de datos */
        .vt-data-grid { 
            display: flex; flex-direction: column; gap: 10px; 
            text-align: left; width: 100%; margin-bottom: 5px;
        }
        .vt-row { display: flex; justify-content: space-between; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 5px; }
        
        .vt-label { font-size: 0.7rem; color: #888; text-transform: uppercase; letter-spacing: 1px; }
        .vt-value { color: white; text-transform: uppercase; font-weight: 700; font-size: 1rem; }
        
        /* CAJA DE NÚMEROS (ESTILO AMARILLO/DORADO) */
        .vt-numbers-box {
            background: #151515; /* Caja gris oscura interna */
            border: 1px solid #333;
            border-radius: 12px;
            padding: 15px;
            margin-top: 5px;
        }
        .vt-numbers-title { font-size: 0.7rem; color: #aaa; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px; display:block; }
        
        .vt-numbers { 
            font-size: 2.2rem; /* REDUCIDO (Antes era 3rem) */
            font-weight: 900; 
            color: #FFD700; /* AMARILLO ORO */
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.4); 
            line-height: 1.1;
            word-wrap: break-word;
        }
        
        .vt-footer { font-size: 0.65rem; color: #444; margin-top: 10px; letter-spacing: 2px; text-transform: uppercase; }


        /* --- FOOTER & EXTRAS --- */
        footer { background: #050505; color: white; padding: 20px 0; text-align: center; margin-top: auto; border-top: 1px solid #222; }
        .footer-socials { margin-bottom: 10px; display: flex; justify-content: center; gap: 25px; }
        .footer-link { color: #888; text-decoration: none; font-size: 0.85rem; border-bottom: 1px dotted #555; transition: 0.3s; cursor: pointer; display: inline-block; margin-top: 8px; }
        .footer-link:hover { color: white; border-color: white; }
        .footer-dev { font-size: 0.8rem; color: #555; margin-top: 10px; }
        .footer-dev a { color: var(--primary); text-decoration: none; font-weight: bold; }

        /* --- OVERLAYS --- */
        body.exclusive-mode nav, body.exclusive-mode footer, body.exclusive-mode #main-content-area { display: none !important; }
        
        .overlay-fullscreen { 
            display: none; 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: #111; /* Fallback */
            background: radial-gradient(circle at center, #222 0%, #000 100%);
            z-index: 9999; 
            flex-direction: column; 
            align-items: center; 
            justify-content: flex-start; 
            overflow-y: auto; 
            padding: 20px; 
            padding-top: 50px; 
        }
        .overlay-fullscreen.active { display: flex !important; }

        #payment-overlay-cards { max-height: none; overflow: visible; padding-bottom: 40px; }

        .admin-grid-menu { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 10px; }
        .admin-menu-item { background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 10px; padding: 20px 10px; text-align: center; cursor: pointer; transition: all 0.2s; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 10px; color: #333; }
        .admin-menu-item:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); border-color: var(--primary); }
        .admin-menu-item i { font-size: 1.5rem; color: var(--primary); }

        .financial-panel { display: none; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0; }
        body.is-admin .financial-panel { display: grid; }
        .stat-card { background: #fff; border: 1px solid #e2e8f0; border-radius: 12px; padding: 20px; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .stat-value { font-size: 1.5rem; font-weight: 800; color: #222; }
        .stat-label { font-size: 0.8rem; color: #777; text-transform: uppercase; letter-spacing: 1px; font-weight: 600; }
        .stat-money { color: #000; }
        .stat-pending { color: #f59e0b; }

        .progress-container { width: 100%; background: #333; height: 14px; border-radius: 7px; overflow: hidden; margin: 20px 0; display: none; border: 1px solid #555; }
        body.is-admin .progress-container, .progress-container.public { display: block; }
        .progress-bar { height: 100%; background: linear-gradient(90deg, var(--primary) 0%, #fff 100%); width: 0%; transition: width 0.6s cubic-bezier(0.22, 1, 0.36, 1); box-shadow: 0 0 15px var(--primary); }
        .progress-bar.sold-out { background: var(--sold-out); box-shadow: 0 0 15px var(--sold-out); }
        .progress-text { font-size: 0.85rem; color: #ddd; margin-bottom: 8px; display: flex; justify-content: space-between; font-weight: 600; }

        .countdown-box { background: rgba(0,0,0,0.6); color: white; padding: 20px; border-radius: 15px; margin-top: 20px; display: none; justify-content: center; gap: 25px; border: 1px solid rgba(255,255,255,0.2); box-shadow: 0 0 30px rgba(0,0,0,0.3); backdrop-filter: blur(5px); }
        .cd-item { text-align: center; }
        .cd-num { font-size: 1.8rem; font-weight: 900; color: white; line-height: 1; text-shadow: 0 0 15px var(--primary); }
        .cd-label { font-size: 0.75rem; text-transform: uppercase; color: #aaa; margin-top: 5px; letter-spacing: 1px; }

                        /* --- AJUSTE SCREENSHOT (Celdas pequeñas, Leyenda Horizontal y FONDO DE COLOR) --- */
        #screenshot-clean-area { 
            background: radial-gradient(circle, #222 0%, #000 100%); 
            padding: 15px; /* Menos padding */
            border-radius: 15px; 
            text-align: center; 
            border: 4px solid var(--primary); 
            width: 100%; 
            max-width: 450px; 
            margin: 0 auto; 
        }
        .ss-header { display:flex; align-items:center; justify-content:center; gap:15px; margin-bottom:10px; }
        .ss-logo { height:50px; max-width:80px; object-fit:contain; filter:drop-shadow(0 0 5px white); }
        .ss-title { color:white; font-weight:900; text-transform:uppercase; font-size:1.2rem; text-align:left; line-height:1.1; text-shadow: 0 0 10px white; }
        
        /* REEMPLAZO: Leyenda forzada a una sola línea y pequeña */
        .leyenda { 
            display: flex; justify-content: center; gap: 5px; margin-top: 5px; margin-bottom: 5px; 
            flex-wrap: nowrap !important; transform: scale(0.9); width: 100%;
        }
        .badge { 
            padding: 4px 8px; border-radius: 20px; font-size: 0.7rem; font-weight: bold; 
            display: flex; align-items: center; gap: 3px; background: #f0f0f0; border: 1px solid #ddd; 
            color: #555; box-shadow: 0 2px 5px rgba(0,0,0,0.05); white-space: nowrap;
        }

        .screenshot-grid { display: flex; flex-wrap: wrap; gap: 2px; justify-content: center; margin-top: 10px; }
        
        /* REEMPLAZO: Celda reducida con FONDO SÓLIDO y texto blanco */
        .screenshot-cell { 
            width: 22px; height: 22px; /* Un poco más grande para que se vea bien el fondo */
            font-size: 0.6rem; 
            display: flex; align-items: center; justify-content: center; font-weight: 800; 
            border-radius: 4px; /* Bordes ligeramente redondeados */
            color: #fff; /* Texto blanco por defecto */
            text-shadow: none; /* Quitamos sombra para que se vea limpio */
            box-shadow: 0 1px 3px rgba(0,0,0,0.3); /* Sombra suave */
            border: none; /* Quitamos bordes individuales */
        }

        /* Estados con fondo de color sólido */
        .ss-free { background: #28a745; } /* Verde para libre */
        .ss-reserved { background: #ffc107; color: #000; /* Amarillo para apartado (texto negro) */ }
        .ss-paid { background: #dc3545; } /* Rojo para pagado */


        /* Slot Machine */
        .slot-machine-wrapper { width: 100%; max-width: 300px; height: 130px; background: #000; border: 5px solid var(--primary); border-radius: 15px; display: flex; justify-content: center; align-items: center; gap: 12px; padding: 12px; margin: 25px auto; box-shadow: 0 0 30px rgba(0,0,0,0.5), inset 0 0 20px rgba(0,0,0,0.8); position: relative; }
        .slot-machine-wrapper::before { content: ''; position: absolute; top: 50%; left: -10px; right: -10px; height: 3px; background: rgba(255,0,0,0.8); z-index: 20; pointer-events: none; box-shadow: 0 0 10px red; }
        .slot-column { width: 30%; height: 100%; background: #fff; border-radius: 8px; overflow: hidden; position: relative; text-align: center; box-shadow: inset 0 0 15px rgba(0,0,0,0.6); border: 2px solid #333; }
        .slot-numbers-strip { display: flex; flex-direction: column; transition: transform 0.1s linear; }
        .spinning .slot-numbers-strip { animation: slotSpin 0.2s infinite linear; }
        @keyframes slotSpin { 0% { transform: translateY(0); } 100% { transform: translateY(-50%); } }
        .slot-num-item { height: 100px; display: flex; align-items: center; justify-content: center; font-size: 3rem; font-weight: 900; }
        
        .admin-dashboard { max-height: 400px; overflow-y: auto; background: #f8fafc; border: 1px solid #e2e8f0; padding: 10px; border-radius: 5px; }
        .admin-group-card { background: white; border-left: 5px solid #ffc107; padding: 15px; margin-bottom: 10px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .group-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .group-tickets { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 10px; }
        .ticket-chip { background: #eee; padding: 2px 8px; border-radius: 10px; font-weight: bold; font-size: 0.9rem; }
        .btn-small { padding: 6px 12px; font-size: 0.85rem; border-radius: 4px; cursor: pointer; border: none; color: white; font-weight: bold; display: flex; align-items: center; gap: 5px; }
        .btn-approve { background: var(--primary); }
        .btn-free { background: #dc3545; }
        .admin-img-list { max-height: 100px; overflow-y: auto; background: white; border: 1px solid #ccc; padding: 5px; margin-top:5px; }
        .admin-img-item { display:flex; justify-content:space-between; font-size:0.8rem; border-bottom:1px solid #eee; padding:2px; color: black; }
        
        /* --- VERIFICADOR MEJORADO --- */
        .search-container { position: relative; margin: 20px 0; color: #333; display: flex; gap: 10px; justify-content: center; }
        .search-input { width: 70%; padding: 12px; border-radius: 30px; border: 2px solid var(--primary); text-align: center; font-size: 1.2rem; background: rgba(255,255,255,0.9); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .search-input:focus { outline: none; box-shadow: 0 0 20px var(--primary); }
        .search-icon { position: absolute; right: 15%; top: 50%; transform: translateY(-50%); color: var(--primary-dark); font-size: 1.2rem; }
        
        .verifier-container { 
            background: rgba(255,255,255,0.95); 
            padding: 30px; 
            border-radius: 20px; 
            margin-bottom: 30px; 
            text-align: center; 
            box-shadow: 0 15px 40px rgba(0,0,0,0.3); 
            border: 2px solid var(--primary);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(5px);
        }
        .verifier-container::after {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 6px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
        }

        .verifier-input { 
            width: 100%; 
            padding: 15px; 
            border-radius: 10px; 
            border: 2px solid #ddd; 
            margin-top: 20px; 
            text-align: center; 
            font-size: 1.2rem;
            color: #222;
            font-weight: bold;
            transition: all 0.3s;
            background: #f9f9f9;
        }
        .verifier-input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 15px var(--primary);
            background: white;
        }

        .login-box { background: rgba(0,0,0,0.9); border: 2px solid var(--primary); padding: 40px; border-radius: 20px; color: white; width: 350px; text-align: center; box-shadow: 0 0 30px rgba(0,0,0,0.8); backdrop-filter: blur(10px); }
        #modal-lucky .modal-content { display: flex; flex-direction: column; align-items: center; justify-content: center; background: #111; border: 2px solid var(--accent); box-shadow: 0 0 40px rgba(255, 215, 0, 0.3); }
        .btn-lucky { background: linear-gradient(45deg, #FFD700, #ffb300); color: black; border: none; padding: 15px 35px; border-radius: 50px; font-weight: 900; font-size: 1.3rem; cursor: pointer; box-shadow: 0 0 25px rgba(255, 215, 0, 0.6); width: 85%; max-width: 450px; margin-bottom: 25px; animation: pulseGold 2s infinite; text-transform: uppercase; letter-spacing: 2px; }
        .vt-numbers.small-text { font-size: 1.4rem; line-height: 1.4; letter-spacing: 1px; }
        .btn-keep-buying { background: transparent; border: 1px solid #aaa; color: #aaa; width: 100%; margin-top: 10px; border-radius: 25px; padding: 10px; font-size: 0.85rem; cursor: pointer; text-decoration: none; display: inline-block; transition: 0.3s; }
        .btn-keep-buying:hover { background: white; color: black; border-color: white; }

        /* --- FIX: SWEETALERT SIEMPRE ENCIMA --- */
        div:where(.swal2-container) {
            z-index: 20000 !important;
        }
        /* ==========================================================================
           AJUSTES ESPECÍFICOS: TÉRMINOS Y CONDICIONES (ESTILO SOLICITADO)
           ========================================================================== */
        
        /* 1. Título Principal del Modal "Términos y Condiciones" */
        #modal-terms .modal-content h3 {
            white-space: nowrap !important;       /* Fuerza una sola línea */
            overflow: hidden !important;          /* Corta si se pasa */
            text-overflow: ellipsis !important;   /* Puntos suspensivos si es necesario */
            font-size: clamp(1.2rem, 5vw, 1.8rem) !important; /* Se ajusta solo al espacio */
            text-align: center !important;
            width: 100% !important;
            max-width: 100%;
        }

        /* 2. Subtítulos de cada término (Ej: "Actividad entre Particulares") */
        #terms-public-content strong {
            display: block;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: clamp(1rem, 4.5vw, 1.2rem); /* Letra dinámica */
            text-align: center;
            width: 100%;
            margin-bottom: 8px;
            color: var(--primary-dark);
            text-transform: uppercase;
        }

        /* 3. Párrafos descriptivos (Texto ancho y justificado) */
        #terms-public-content p {
            text-align: justify;       /* Estira el texto a los lados */
            text-align-last: center;   /* Centra la última línea (estética) */
            padding: 0 2px;            /* Casi pegado a los bordes */
            margin: 0 auto;
            width: 100%;
            font-size: 0.95rem;
            line-height: 1.5;
            color: #444;
        }


    </style>

</head>
<body>
    <div id="skeleton-loader">
        <div class="sk-spinner"></div>
        <div class="sk-text">Cargando Sistema...</div>
    </div>
    
      <div id="overlay-ticket" class="overlay-fullscreen">
        <div class="virtual-ticket-card" style="margin-top: 20px;">
            <div class="vt-shine"></div>
            
            <div class="vt-header-group">
                <img src="https://i.ibb.co/b5HD5sPD/Picsart-26-01-23-15-46-54-673.png" class="vt-logo" alt="Logo">
                <div class="vt-text-col">
                    <div class="vt-congrats">¡FELICIDADES!</div>
                    <div class="vt-msg">✅ Boleto Confirmado</div>
                </div>
            </div>

            <img id="vt-link-img" src="" class="vt-event-img" style="display:none;">
            
            <div class="vt-data-grid">
                <div>
                    <div class="vt-label">Participante</div>
                    <div id="vt-link-client" class="vt-value">CARGANDO...</div>
                </div>
                <div>
                    <div class="vt-label">Sorteo</div>
                    <div id="vt-link-event-name" class="vt-value" style="font-size:0.8rem;">...</div>
                </div>
            </div>
            
            <div class="vt-label">TUS NÚMEROS DE LA SUERTE</div>
            <div id="vt-link-num" class="vt-numbers">00</div>
            
            <div class="vt-data-grid" style="margin-top:10px; margin-bottom:0;">
                <div>
                    <div class="vt-label">Ubicación</div>
                    <div id="vt-link-state" class="vt-value" style="font-size:0.8rem;">...</div>
                </div>
                <div style="text-align:right;">
                    <div class="vt-label">Fecha</div>
                    <div class="vt-value" style="font-size:0.8rem;">HOY</div>
                </div>
            </div>

            <div class="vt-footer">Tu Suerte Suma | Mucha Suerte 🍀</div>
        </div>
        
        <p style="color:#999; margin-top:20px; text-align:center; padding:0 20px;">
            Guarda este boleto como comprobante.<br>
            <span style="font-size:0.8rem;">(Toma una captura de pantalla)</span>
        </p>
    </div>
 
    <div id="overlay-payment" class="overlay-fullscreen">
        <img src="https://i.ibb.co/b5HD5sPD/Picsart-26-01-23-15-46-54-673.png" style="height:80px; margin-bottom:20px; filter:drop-shadow(0 0 5px white);">
        <h2 class="section-title" style="color:var(--accent);">Métodos de Pago</h2>
        <p style="color:#eee; text-align:center; max-width:600px; margin-bottom:20px; padding:0 20px;">
            Por favor realiza el pago a cualquiera de las siguientes cuentas y envía tu comprobante.
        </p>
        
        <div class="cards-grid" id="payment-overlay-cards"></div>
        
        <button onclick="sendPaymentProof()" class="btn-whatsapp-share" style="max-width:300px; margin-top:30px;">
            <i class="fab fa-whatsapp"></i> Envía tu comprobante aquí
        </button>
        <p style="color:#999; font-size:0.8rem; margin-top:15px;">Tu Suerte Suma | Pagos Seguros</p>
    </div>

    <div id="modal-settings-menu" class="modal-overlay" onclick="closeModal('modal-settings-menu')">
        <div class="modal-content" onclick="event.stopPropagation()" style="max-width:500px;">
            <div class="close-btn" onclick="closeModal('modal-settings-menu')">&times;</div>
            <h3 style="color:var(--primary-dark); text-transform:uppercase; border-bottom:2px solid var(--accent); padding-bottom:10px; margin-bottom:20px;">
                Panel de Control
            </h3>
            
            <div class="admin-grid-menu">
                <div class="admin-menu-item" onclick="openConfigTexts()">
                    <i class="fas fa-edit"></i>
                    <span>Editar Textos Web</span>
                </div>
                <div class="admin-menu-item" onclick="openConfigContact()">
                    <i class="fas fa-address-book"></i>
                    <span>Contacto y Redes</span>
                </div>
                <div class="admin-menu-item" onclick="openConfigTheme()">
                    <i class="fas fa-palette"></i>
                    <span>Tema / Color</span>
                </div>
                <div class="admin-menu-item" onclick="openTermsEditor()">
                    <i class="fas fa-file-contract"></i>
                    <span>Términos</span>
                </div>
                <div class="admin-menu-item" onclick="openFaqEditor()">
                    <i class="fas fa-question-circle"></i>
                    <span>Preguntas (FAQ)</span>
                </div>
                <div class="admin-menu-item" onclick="logoutAdmin()" style="border-color:#dc3545;">
                    <i class="fas fa-sign-out-alt" style="color:#dc3545;"></i>
                    <span style="color:#dc3545;">Cerrar Sesión</span>
                </div>
            </div>

            <div style="margin-top:20px; font-size:0.8rem; color:#999;">
                Sistema CMS V8.0 | Modo Administrador
            </div>
        </div>
    </div>

    <div id="modal-config-texts" class="modal-overlay">
        <div class="modal-content" style="max-width:600px; text-align:left;">
            <div class="close-btn" onclick="closeModal('modal-config-texts')">&times;</div>
            <h3 style="text-align:center; color:var(--primary-dark); margin-bottom:15px;">Editar Contenidos</h3>
            
            <h4 style="color:var(--accent); margin-bottom:10px; border-bottom:1px solid #eee;">Sección Principal (Inicio)</h4>
            <div class="form-group">
                <label>Título Principal</label>
                <input type="text" id="txt-hero-title" class="form-control" placeholder="¡PARTICIPA Y GANA!">
            </div>
            <div class="form-group">
                <label>Subtítulo / Oportunidad</label>
                <input type="text" id="txt-hero-desc" class="form-control" placeholder="Tu oportunidad de ganar...">
            </div>

            <h4 style="color:var(--accent); margin-top:20px; margin-bottom:10px; border-bottom:1px solid #eee;">Sección Quiénes Somos</h4>
            <div class="form-group">
                <label>Título / Saludo</label>
                <input type="text" id="txt-bio-main" class="form-control" placeholder='"Hola! Bienvenido..."'>
            </div>
            <div class="form-group">
                <label>Subtítulo (Slogan)</label>
                <input type="text" id="txt-bio-subtitle" class="form-control" placeholder="Tu Suerte Suma: Ganamos Todos">
            </div>
            <div class="form-group">
                <label>Nuestra Historia (Texto)</label>
                <textarea id="txt-bio-history" class="form-control" rows="4" placeholder="Escribe tu historia aquí..."></textarea>
            </div>
            <div class="form-group">
                <label>¿Por qué nace este proyecto? (Texto)</label>
                <textarea id="txt-bio-why" class="form-control" rows="4" placeholder="Escribe el motivo aquí..."></textarea>
            </div>

            <button onclick="saveTextsConfig()" class="btn-action" style="width:100%; margin-top:15px;">💾 GUARDAR TEXTOS</button>
        </div>
    </div>

    <div id="modal-config-contact" class="modal-overlay">
        <div class="modal-content" style="max-width:450px; text-align:left;">
            <div class="close-btn" onclick="closeModal('modal-config-contact')">&times;</div>
            <h3 style="text-align:center; color:var(--primary-dark); margin-bottom:15px;">Contacto y Redes</h3>
            <p style="font-size:0.85rem; color:#666; text-align:center; margin-bottom:20px;">
                Estos enlaces aparecen en los iconos y <b>se envían automáticamente en el mensaje de confirmación</b>.
            </p>
            <div class="form-group" style="margin-bottom:15px;">
                <label>WhatsApp de Pedidos (Tu Número)</label>
                <input type="text" id="cfg-wa-orders" class="form-control" placeholder="Ej: 5219999999999">
            </div>
            <div class="form-group" style="margin-bottom:15px;">
                <label>Enlace Canal de WhatsApp</label>
                <input type="text" id="cfg-wa-channel" class="form-control" placeholder="https://whatsapp.com/channel/...">
            </div>
            <div class="form-group" style="margin-bottom:15px;">
                <label>Enlace Facebook</label>
                <input type="text" id="cfg-fb-link" class="form-control" placeholder="https://facebook.com/...">
            </div>
            <button onclick="saveContactConfig()" class="btn-action" style="width:100%;">💾 GUARDAR CAMBIOS</button>
        </div>
    </div>

    <div id="modal-config-theme" class="modal-overlay">
        <div class="modal-content" style="max-width:400px;">
            <div class="close-btn" onclick="closeModal('modal-config-theme')">&times;</div>
            <h3 style="text-align:center; color:var(--primary-dark); margin-bottom:15px;">Color del Sitio</h3>
            <div class="color-selector-grid">
                <div class="color-btn" style="background: linear-gradient(135deg, #064e3b, #047857);" onclick="applyTheme('default')" title="Verde Esmeralda"></div>
                <div class="color-btn" style="background: linear-gradient(135deg, #800000, #991b1b);" onclick="applyTheme('theme-maroon')" title="Vino Tinto"></div>
                <div class="color-btn" style="background: linear-gradient(135deg, #004085, #007bff);" onclick="applyTheme('theme-blue')" title="Azul Real"></div>
                <div class="color-btn" style="background: linear-gradient(135deg, #b91c1c, #ef4444);" onclick="applyTheme('theme-red')" title="Rojo Carmesí"></div>
                <div class="color-btn" style="background: linear-gradient(135deg, #880e4f, #db2777);" onclick="applyTheme('theme-pink')" title="Rosa Neón"></div>
                <div class="color-btn" style="background: linear-gradient(135deg, #d35400, #f97316);" onclick="applyTheme('theme-orange')" title="Naranja Sunset"></div>
                <div class="color-btn" style="background: linear-gradient(135deg, #b78a02, #eab308);" onclick="applyTheme('theme-yellow')" title="Dorado Lujo"></div>
                <div class="color-btn" style="background: linear-gradient(135deg, #581c87, #9333ea);" onclick="applyTheme('theme-purple')" title="Púrpura Cyber"></div>
                <div class="color-btn" style="background: linear-gradient(135deg, #000000, #374151);" onclick="applyTheme('theme-black')" title="Negro Midnight"></div>
                <div class="color-btn" style="background: linear-gradient(135deg, #0f766e, #0d9488);" onclick="applyTheme('theme-teal')" title="Turquesa Ocean"></div>
            </div>
            <button onclick="saveThemeConfig()" class="btn-action" style="width:100%; margin-top:20px;">💾 GUARDAR TEMA</button>
        </div>
    </div>

    <div id="modal-editor-terms" class="modal-overlay">
        <div class="modal-content" style="max-width:600px; text-align:left;">
            <div class="close-btn" onclick="closeModal('modal-editor-terms')">&times;</div>
            <h3 style="text-align:center; color:var(--primary-dark); margin-bottom:15px;">Editar Términos</h3>
            <div id="cms-terms-list-container" class="cms-term-list"></div>
            <button onclick="addTermBlockUI()" class="btn-action" style="background:#333; margin-bottom:10px;">+ Agregar Nuevo Bloque</button>
            <button onclick="saveTermsConfig()" class="btn-action" style="width:100%;">💾 GUARDAR CAMBIOS</button>
        </div>
    </div>

    <div id="modal-editor-faq" class="modal-overlay">
        <div class="modal-content" style="max-width:600px; text-align:left;">
            <div class="close-btn" onclick="closeModal('modal-editor-faq')">&times;</div>
            <h3 style="text-align:center; color:var(--primary-dark); margin-bottom:15px;">Preguntas Frecuentes</h3>
            <div id="cms-faq-list-container" class="cms-term-list"></div>
            <button onclick="addFaqBlockUI()" class="btn-action" style="background:#333; margin-bottom:10px;">+ Agregar Nueva Pregunta</button>
            <button onclick="saveFaqConfig()" class="btn-action" style="width:100%;">💾 GUARDAR CAMBIOS</button>
        </div>
    </div>

    <div id="loginModal" class="modal-overlay" onclick="closeModal('loginModal')">
        <div class="login-box" onclick="event.stopPropagation()">
            <div class="close-btn" onclick="closeModal('loginModal')" style="background:transparent; color:white;">&times;</div>
            <h3 style="color:var(--primary);">Admin Access</h3>
            <p style="color:#aaa; font-size:0.8rem; margin-bottom:15px;">Ingresa tus credenciales.</p>
            <input type="text" id="adminUser" placeholder="Correo de Admin" style="width:100%; padding:8px; margin-bottom:10px; border-radius:5px; border:none;">
            <input type="password" id="adminPass" placeholder="Contraseña" style="width:100%; padding:8px; margin-bottom:10px; border-radius:5px; border:none;">
            <button onclick="attemptLogin()" class="btn-action" style="width:100%;">ENTRAR</button>
        </div>
    </div>

    <div id="modal-event-config" class="modal-overlay" style="display:none;">
        <div class="modal-content" style="max-width:500px; text-align:left;">
            <div class="close-btn" onclick="closeModal('modal-event-config')">&times;</div>
            <h3 style="color:var(--primary-dark); text-align:center; margin-bottom:15px;">Configurar Evento</h3>
            <input type="hidden" id="edit-event-id">
            
            <div class="form-group">
                <label>Nombre del Evento</label>
                <input type="text" id="evt-title" class="form-control" placeholder="Ej: Rifa iPhone 15">
            </div>

            <div class="form-group" style="margin-top:10px;">
                <label>Tipo de Rifa (Modalidad)</label>
                <select id="evt-type" class="form-control" style="border-left: 4px solid var(--accent);">
                    <option value="amigos">Entre Amigos (Manual/Local)</option>
                    <option value="nacional">Lotería Nacional (Premio Mayor)</option>
                    <option value="tris">Sorteo Tris (Mediodía/Noche)</option>
                </select>
                <small style="color:#666; font-size:0.75rem;">Define la base del sorteo para tus clientes.</small>
            </div>

            <div class="admin-form-grid" style="margin-top:10px;">
                <div class="form-group">
                    <label>Precio</label>
                    <input type="number" id="evt-price" class="form-control" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label>Boletos (Oportunidades)</label>
                    <select id="evt-qty" class="form-control">
                        <option value="10">10 Boletos (Muy Exclusiva)</option>
                        <option value="25">25 Boletos (Cuádruple)</option>
                        <option value="50">50 Boletos (Doble)</option>
                        <option value="100">100 Boletos (Normal 00-99)</option>
                        <option value="150">150 Boletos</option>
                        <option value="200">200 Boletos</option>
                        <option value="333">333 Boletos (Especial 3 cifras)</option>
                        <option value="500">500 Boletos</option>
                        <option value="1000">1000 Boletos (000-999)</option>
                        <option value="2500">2500 Boletos</option>
                        <option value="5000">5000 Boletos</option>
                        <option value="10000">10000 Boletos (0000-9999)</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group" style="margin-bottom:15px;">
                <label>Fecha Límite (Cuenta Regresiva)</label>
                <input type="datetime-local" id="evt-date-end" class="form-control">
                <small style="color:#666; font-size:0.75rem;">Dejar vacío para ocultar contador.</small>
            </div>
            <div class="form-group">
                <label>Imagen (URL)</label>
                <input type="text" id="evt-img" class="form-control" placeholder="https://...">
            </div>
            <div class="form-group">
                <label>Descripción Corta (Tarjeta)</label>
                <input type="text" id="evt-desc-short" class="form-control" placeholder="Ej: Gran sorteo navideño...">
            </div>
            <div class="form-group">
                <label>Descripción Larga (Detalles)</label>
                <textarea id="evt-desc-long" class="form-control" rows="3" placeholder="Detalles completos..."></textarea>
            </div>
            <div style="display:flex; gap:10px; margin-top:20px;">
                <button onclick="saveEventConfig()" class="btn-action" style="width:100%;">💾 GUARDAR EVENTO</button>
                <button id="btn-delete-event" onclick="deleteCurrentEvent()" class="btn-action" style="background:#dc3545; display:none;">🗑️</button>
            </div>
        </div>
    </div>
    <div id="modal-lucky" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <div class="close-btn" onclick="closeModal('modal-lucky')">&times;</div>
            <h3 style="color:var(--accent);">🎰 Máquina de la Suerte</h3>
            
            <div id="lucky-step-1">
                <p style="color:#eee;">Elige cuántos boletos quieres:</p>
                <div style="display:flex; justify-content:center; gap:10px; margin:20px 0;">
                    <button onclick="setLucky(2)" class="btn-action" style="width:auto; background:#333;">2</button>
                    <button onclick="setLucky(5)" class="btn-action" style="width:auto; background:#333;">5</button>
                    <input type="number" id="lucky-qty" class="form-control" placeholder="#" style="width:80px; text-align:center;">
                </div>
                <button onclick="spinRoulette()" class="btn-action" style="background:var(--accent); color:black; width:100%;">¡GIRAR!</button>
            </div>
            
            <div id="lucky-step-2" style="display:none; width:100%;">
                <div class="slot-machine-wrapper">
                    <div class="slot-column"><div class="slot-numbers-strip" id="slot-strip-1"></div></div>
                    <div class="slot-column"><div class="slot-numbers-strip" id="slot-strip-2"></div></div>
                    <div class="slot-column"><div class="slot-numbers-strip" id="slot-strip-3"></div></div>
                </div>
                <h2 id="lucky-result-text" style="color:var(--primary); margin:15px 0; font-size:1.5rem; min-height:30px;">¡SUERTE!</h2>
                <div style="display:flex; gap:10px; justify-content:center; margin-top:20px;">
                    <button onclick="resetLucky()" class="btn-action" style="background:#555;">Otra vez</button>
                    <button onclick="confirmLucky()" class="btn-action">¡Los quiero!</button>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-terms" class="modal-overlay" onclick="closeModal('modal-terms')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="close-btn" onclick="closeModal('modal-terms')">&times;</div>
            <h3 style="color:var(--primary-dark); text-transform:uppercase; border-bottom:2px solid var(--accent); padding-bottom:10px;">Términos y Condiciones</h3>
            <div class="terms-text" id="terms-public-content">
                <p>Cargando términos...</p>
            </div>
            <button onclick="closeModal('modal-terms')" class="btn-action" style="background: #333; width:100%;">Entendido y Acepto</button>
        </div>
    </div>

    <div id="modal-form" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <div class="close-btn" onclick="closeModal('modal-form')">&times;</div>
            <h3 style="color:var(--primary);">¡Casi tuyos!</h3>
            <div style="background:#f9f9f9; padding:15px; border-radius:10px; margin-bottom:15px;">
                <p>Boletos: <b id="form-nums" style="color:var(--primary-dark);">...</b></p>
                <p style="font-size:1.2rem; margin-top:5px;">Total a pagar: <b id="form-total" style="font-size:1.5rem; color:#dc3545;">$0</b></p>
            </div>
            <input type="text" id="user-name" class="form-control" placeholder="Tu Nombre Completo" style="width:100%; margin:5px 0;">
            <input type="text" id="user-state" class="form-control" placeholder="Tu Estado (Ej: CDMX, Estado de México)" style="width:100%; margin:5px 0;">
            <input type="tel" id="user-phone" class="form-control" placeholder="Tu Teléfono (WhatsApp)" style="width:100%; margin:5px 0;">
            <button onclick="sendWhatsApp()" class="btn-action" style="background:#25D366; margin-top:15px; width:100%;">
                <i class="fab fa-whatsapp"></i> APARTAR AHORA
            </button>
        </div>
    </div>

           <div id="modal-virtual-ticket" class="modal-overlay" style="display:none;">
        <div class="modal-content" style="background:transparent; box-shadow:none; padding:0; width:100%; display:flex; flex-direction:column; align-items:center;">
            
            <div class="virtual-ticket-card">
                <div class="vt-header-group">
                    <img src="https://i.ibb.co/b5HD5sPD/Picsart-26-01-23-15-46-54-673.png" class="vt-logo" alt="Logo">
                    <div class="vt-text-col">
                        <div class="vt-congrats">¡FELICIDADES!</div>
                        <div class="vt-msg">✅ Boleto Confirmado</div>
                    </div>
                </div>

                <div class="vt-data-grid">
                    <div class="vt-row">
                        <div class="vt-label">PARTICIPANTE</div>
                        <div id="vt-client" class="vt-value">CARGANDO...</div>
                    </div>
                    <div class="vt-row">
                        <div class="vt-label">SORTEO</div>
                        <div id="vt-event-name" class="vt-value" style="font-size:0.9rem; color:#ddd;">...</div>
                    </div>
                </div>
                
                <div class="vt-numbers-box">
                    <span class="vt-numbers-title">TUS NÚMEROS DE LA SUERTE</span>
                    <div id="vt-num" class="vt-numbers">00, 00</div>
                </div>
                
                <div class="vt-footer">Tu Suerte Suma | Comprobante Oficial</div>
            </div>

            <div style="background:white; padding:15px; border-radius:15px; margin-top:15px; text-align:center; width:90%; max-width:380px; box-shadow: 0 5px 20px rgba(0,0,0,0.5);">
                <p style="color:#333; font-weight:bold; font-size:0.85rem; margin-bottom:10px;">👇 Guarda tu boleto y envíalo 👇</p>
                
                <button onclick="shareTicketWhatsApp()" class="btn-whatsapp-share" style="margin-top:0; width:100%; padding:12px; background:#25D366; color:white; border:none; border-radius:30px; font-weight:800; font-size:1rem; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:8px;">
                    <i class="fab fa-whatsapp"></i> ENVIAR CONFIRMACIÓN
                </button>
                
                <div style="display:flex; gap:10px; margin-top:10px;">
                    <button onclick="closeModal('modal-virtual-ticket'); showPage('inicio')" class="btn-keep-buying" style="flex:1; border:1px solid #ccc; color:#555;">
                        <i class="fas fa-home"></i> Inicio
                    </button>
                    <button onclick="closeModal('modal-virtual-ticket')" class="btn-keep-buying" style="flex:1; border:1px solid #ccc; color:#555;">
                         Cerrar
                    </button>
                </div>
            </div>
        </div>
    </div>


    <div id="modal-admin-ticket" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <div class="close-btn" onclick="closeModal('modal-admin-ticket')">&times;</div>
            <h3 style="color:var(--primary-dark);">Gestión Boleto #<span id="adm-ticket-num"></span></h3>
            
            <div style="background:#f9f9f9; padding:15px; text-align:left; border-radius:10px; margin-bottom:15px; border:1px solid #eee;">
                <div class="admin-detail-row">
                    <span class="admin-detail-label">Cliente:</span>
                    <span class="admin-detail-value" id="adm-client">Cargando...</span>
                </div>
                <div class="admin-detail-row">
                    <span class="admin-detail-label">Teléfono:</span>
                    <span class="admin-detail-value" id="adm-phone">...</span>
                </div>
                <div class="admin-detail-row">
                    <span class="admin-detail-label">Ubicación (Estado):</span>
                    <span class="admin-detail-value" id="adm-state">...</span>
                </div>
                <div class="admin-detail-row" style="border-bottom:none;">
                    <span class="admin-detail-label">Status Pago:</span>
                    <span class="admin-detail-value" id="adm-status" style="color:var(--primary);">...</span>
                </div>
            </div>

            <div style="margin-bottom:15px;">
                <label style="font-size:0.8rem; font-weight:bold; color:#666;">Todos los boletos de este usuario:</label>
                <div id="adm-all-tickets" style="background:#eee; padding:5px; border-radius:5px; font-weight:bold; word-wrap:break-word; font-size:0.9rem;">...</div>
            </div>
            
            <button onclick="changeStatus('disponible')" class="btn-action" style="background:#ef4444; width:100%; margin-bottom:5px;">LIBERAR (BORRAR)</button>
            
            <a id="adm-wa-link" href="#" target="_blank" class="btn-action" style="background:#25D366; width:100%; text-align:center;">
                <i class="fab fa-whatsapp"></i> CONTACTAR (SOLO CHAT)
            </a>
        </div>
    </div>
    
    <div id="modal-payment-success" class="modal-overlay" style="display:none;">
        <div class="modal-content" style="text-align:center; border:2px solid #28a745;">
            <div class="close-btn" onclick="closeModal('modal-payment-success')">&times;</div>
            <div style="font-size:3rem; color:#28a745; margin-bottom:10px;"><i class="fas fa-check-circle"></i></div>
            <h3 style="color:#28a745; text-transform:uppercase; margin-bottom:10px;">¡Pago Confirmado con Éxito!</h3>
            <p style="color:#666; margin-bottom:20px;">El boleto y su grupo han sido marcados como PAGADOS.</p>
            
            <input type="hidden" id="success-target-phone">
            <input type="hidden" id="success-target-tickets">
            
            <button onclick="sendConfirmationToClient()" class="btn-action" style="background:#25D366; width:100%; padding:15px; font-size:1.1rem; border-radius:50px;">
                <i class="fab fa-whatsapp"></i> ENVIAR MENSAJE DE CONFIRMACIÓN
            </button>
            <p style="font-size:0.75rem; color:#999; margin-top:10px;">Esto abrirá WhatsApp con el boleto digital generado y el nuevo mensaje.</p>
        </div>
    </div>

    <div id="modal-screenshot" class="modal-overlay" style="display:none; align-items:flex-start; padding-top:50px; overflow-y:auto;">
        <div style="width:100%; display:flex; flex-direction:column; align-items:center;">
            <div id="screenshot-clean-area">
                <div class="ss-header">
                    <img src="https://i.ibb.co/b5HD5sPD/Picsart-26-01-23-15-46-54-673.png" class="ss-logo" alt="Logo">
                    <div class="ss-title" id="ss-event-title">EVENTO</div>
                </div>
                <div class="leyenda" style="margin-bottom:10px; transform:scale(0.8);">
                    <span class="badge" style="color:#28a745"><i class="fas fa-circle"></i> Libre</span>
                    <span class="badge" style="color:#ffc107"><i class="fas fa-circle"></i> Apartado</span>
                    <span class="badge" style="color:#dc3545"><i class="fas fa-circle"></i> Pagado</span>
                </div>
                <div id="screenshot-grid-target" class="screenshot-grid"></div>
            </div>

            <button onclick="closeModal('modal-screenshot')" class="btn-action" style="background:#333; margin-top:20px;">Cerrar Vista</button>
            <p style="color:white; font-size:0.8rem; margin-top:10px;">Toma una captura de pantalla de esta zona 👆</p>
        </div>
    </div>

    <div id="modal-cms-edit" class="modal-overlay" style="display:none;">
        <div class="modal-content" style="max-width:600px; text-align:left;">
            <div class="close-btn" onclick="closeModal('modal-cms-edit')">&times;</div>
            <h3 style="color:var(--primary-dark); text-align:center; margin-bottom:15px;">✏️ Editar Contenido</h3>
            <input type="hidden" id="cms-target-id">
            <textarea id="cms-input-content" class="cms-editor-textarea" rows="5" style="width:100%; padding:10px; border:1px solid #ccc; border-radius:5px;"></textarea>
            <div style="display:flex; gap:10px; margin-top:10px;">
                <button onclick="closeModal('modal-cms-edit')" class="btn-action" style="background:#555;">Cancelar</button>
                <button onclick="saveCmsContent()" class="btn-action" style="width:100%;">💾 GUARDAR</button>
            </div>
        </div>
    </div>

    <nav>
        <div class="nav-structure">
            <div class="nav-top-row">
                <div class="nav-floating-left">
                    </div>

                <a onclick="showPage('pagos')" class="nav-link-side">Métodos de Pago</a>
                
                <div class="logo-container">
                    <img src="https://i.ibb.co/b5HD5sPD/Picsart-26-01-23-15-46-54-673.png" alt="Logo" class="nav-logo-img" onclick="openLogin()">
                </div>

                <a onclick="showPage('sorteos')" class="nav-link-side">Sorteos Disponibles</a>

                <div class="nav-floating-right">
                    <a id="social-fb-nav" href="#" target="_blank" class="social-btn" title="Facebook"><i class="fab fa-facebook-f"></i></a>
                    <a id="social-wa-nav" href="#" target="_blank" class="social-btn" title="Canal WhatsApp"><i class="fab fa-whatsapp"></i></a>
                </div>
            </div>

            <div class="nav-admin-row admin-only">
                <button onclick="openSettingsMenu()" class="btn-panel-rectangular">
                    <i class="fas fa-cogs"></i> PANEL DE CONTROL
                </button>
            </div>

            <div class="nav-bottom-row">
                <a onclick="showPage('inicio')" id="nav-inicio" class="nav-link-home">Inicio</a>
            </div>
        </div>
    </nav>
    <div id="main-content-area">

        <div id="page-inicio" class="page-view" style="display:block;">
            
            <div class="hero">
                <h1 id="view-hero-title" class="urgent-title">¡PARTICIPA Y GANA!</h1>
                <p id="view-hero-desc" class="short-desc">Tu oportunidad de ganar efectivo y apoyar una causa real.</p>
                
                <div class="nav-admin-row admin-only" style="margin-bottom:15px; background:transparent; border:none;">
                    <button onclick="openConfigTexts()" class="btn-action" style="background:rgba(0,0,0,0.6); border:1px solid white; font-size:0.8rem;">
                        ✏️ EDITAR TEXTOS
                    </button>
                </div>
                
                <h3 style="color:var(--accent); text-transform:uppercase; margin-bottom:15px; border-bottom:2px solid var(--accent); display:inline-block;">
                    🔥 Sorteos Activos 🔥
                </h3>
                
                <div class="home-carousel-wrapper">
                    <button class="carousel-nav-btn prev" id="home-prev-btn" onclick="scrollHomeCarousel(-1)">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    
                    <div class="home-events-container" id="home-events-scroll-area">
                        <div id="home-events-track" class="carousel-track" style="display:flex; gap:20px;">
                            <p style="color:white; width:100%; text-align:center;">Cargando sorteos...</p>
                        </div>
                    </div>

                    <button class="carousel-nav-btn next" id="home-next-btn" onclick="scrollHomeCarousel(1)">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>

            <section class="bio-section">
                <div class="bio-header">
                    <img src="https://i.ibb.co/b5HD5sPD/Picsart-26-01-23-15-46-54-673.png" alt="Logo" class="bio-logo-small">
                    
                    <div style="position: relative; display: inline-block; width: 100%; text-align: center;">
                        <h2 class="bio-title-main">¿QUIÉNES SOMOS?</h2>
                        
                        <span id="view-bio-subtitle" class="bio-subtitle-editable">Tu Suerte Suma: Ganamos Todos</span>
                        
                        <div id="view-bio-main" style="margin-top:15px; font-weight:bold; font-style:italic; color: var(--accent);">
                            "¡Hola! Bienvenido a Tu Suerte Suma..."
                        </div>
                    </div>
                </div>

                <div class="bio-text">
                    <div style="margin-bottom: 20px;">
                        <span class="bio-highlight">MI HISTORIA:</span>
                        <p id="view-bio-history">Cargando información...</p>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <span class="bio-highlight">¿POR QUÉ NACE ESTE PROYECTO?</span>
                        <p id="view-bio-why">Cargando información...</p>
                    </div>
                    
                    <div class="nav-admin-row admin-only" style="background:transparent; border:none;">
                        <button onclick="openConfigTexts()" class="btn-action" style="background:#333; font-size:0.8rem;">
                            ✏️ EDITAR BIOGRAFÍA
                        </button>
                    </div>
                </div>
            </section>

            <section class="evidence-section">
                <h2 class="section-title">Evidencia de Ganadores</h2>
                <div id="evidenceTextDefault"><p style="color: #ccc;">Aún estamos preparando nuestro primer gran sorteo.</p></div>
                
                <div id="evidenceCarouselContainer" class="carousel-container" style="background: black; border-color: var(--accent);">
                    <button class="c-btn prev" onclick="moveCarousel('evidence', -1)">&#10094;</button>
                    <div id="evidenceCarouselImgWrapper" class="carousel-slide"></div>
                    <button class="c-btn next" onclick="moveCarousel('evidence', 1)">&#10095;</button>
                </div>
                
                <div class="admin-controls admin-only">
                    <div class="admin-title">🏆 Admin: Carrusel Evidencia</div>
                    <input type="text" id="imgEvidenceInput" class="form-control" placeholder="URL Imagen" style="width:70%; display:inline-block;">
                    <button onclick="addImage('evidence')" class="btn-action" style="width:25%;">Subir</button>
                    <div id="evidenceImgList" class="admin-img-list" style="color:black;"></div>
                </div>
            </section>

            <section class="faq-section">
                <h2 class="section-title">Preguntas Frecuentes</h2>
                
                <div id="faq-list-public">
                    <p style="text-align:center; color:#ccc;">Cargando preguntas frecuentes...</p>
                </div>
                
                <div class="admin-controls admin-only" style="margin-top:20px; text-align:center; border:none; shadow:none; background:transparent;">
                     <button class="btn-action" style="background:var(--dark); border:1px solid var(--accent);" onclick="openFaqEditor()">⚙️ Editar Preguntas</button>
                </div>
            </section>
        </div>

        <div id="page-pagos" class="page-view">
            <div class="container" style="text-align:center; padding: 0 15px;">
                
                <div class="admin-controls admin-only">
                    <div class="admin-title">💳 Admin: Editar Cuentas Bancarias</div>
                    
                    <div class="bank-edit-grid">
                        <div class="bank-row-header"><label class="switch"><input type="checkbox" id="checkBBVA" onchange="saveBank('bbva')"><span class="slider"></span></label><span>BBVA</span></div>
                        <div class="bank-row-inputs"><input id="nameBBVA" class="form-control" placeholder="Titular"><input id="numBBVA" class="form-control" placeholder="Cuenta / CLABE"></div>
                        <button onclick="saveBank('bbva')" class="btn-action" style="margin-top:5px;">Guardar BBVA</button>
                    </div>
                    <div class="bank-edit-grid">
                        <div class="bank-row-header"><label class="switch"><input type="checkbox" id="checkAzteca" onchange="saveBank('azteca')"><span class="slider"></span></label><span>Banco Azteca</span></div>
                        <div class="bank-row-inputs"><input id="nameAzteca" class="form-control" placeholder="Titular"><input id="numAzteca" class="form-control" placeholder="Cuenta / CLABE"></div>
                        <button onclick="saveBank('azteca')" class="btn-action" style="margin-top:5px;">Guardar Azteca</button>
                    </div>
                    <div class="bank-edit-grid">
                        <div class="bank-row-header"><label class="switch"><input type="checkbox" id="checkMP" onchange="saveBank('mp')"><span class="slider"></span></label><span>Mercado Pago</span></div>
                        <div class="bank-row-inputs"><input id="nameMP" class="form-control" placeholder="Titular"><input id="numMP" class="form-control" placeholder="Teléfono / Cuenta"></div>
                        <button onclick="saveBank('mp')" class="btn-action" style="margin-top:5px;">Guardar MP</button>
                    </div>
                    <div class="bank-edit-grid">
                        <div class="bank-row-header"><label class="switch"><input type="checkbox" id="checkOxxo" onchange="saveBank('oxxo')"><span class="slider"></span></label><span>OXXO</span></div>
                        <div class="bank-row-inputs"><input id="nameOxxo" class="form-control" placeholder="Titular"><input id="numOxxo" class="form-control" placeholder="Num. Tarjeta"></div>
                        <button onclick="saveBank('oxxo')" class="btn-action" style="margin-top:5px;">Guardar OXXO</button>
                    </div>
                    <div class="bank-edit-grid">
                        <div class="bank-row-header"><label class="switch"><input type="checkbox" id="checkBanorte" onchange="saveBank('banorte')"><span class="slider"></span></label><span>Banorte</span></div>
                        <div class="bank-row-inputs"><input id="nameBanorte" class="form-control" placeholder="Titular"><input id="numBanorte" class="form-control" placeholder="Cuenta / CLABE"></div>
                        <button onclick="saveBank('banorte')" class="btn-action" style="margin-top:5px;">Guardar Banorte</button>
                    </div>
                    <div class="bank-edit-grid">
                        <div class="bank-row-header"><label class="switch"><input type="checkbox" id="checkBanamex" onchange="saveBank('banamex')"><span class="slider"></span></label><span>Banamex</span></div>
                        <div class="bank-row-inputs"><input id="nameBanamex" class="form-control" placeholder="Titular"><input id="numBanamex" class="form-control" placeholder="Cuenta / CLABE"></div>
                        <button onclick="saveBank('banamex')" class="btn-action" style="margin-top:5px;">Guardar Banamex</button>
                    </div>

                    <div style="margin-top:20px; border-top:1px solid #ddd; padding-top:10px;">
                        <button onclick="sharePaymentLink()" class="btn-action" style="background:#333; width:100%;">
                            <i class="fas fa-share-alt"></i> COPIAR LINK DE PAGOS
                        </button>
                    </div>
                </div>

                <h2 class="section-title">Métodos de Pago</h2>
                <p style="color:#ddd; margin-bottom:2rem;">Selecciona, copia y envía tu comprobante.</p>

                                <div class="cards-grid">
                    <div id="card-bbva-main" class="bank-card card-bbva">
                        <div class="card-top">
                            <img src="https://i.ibb.co/zTZbpYx8/pngwing-com.png" class="card-logo-bank-icon" style="filter: brightness(0) invert(1);">
                            <img src="https://i.ibb.co/zTZbpYx8/pngwing-com.png" class="card-logo-img">
                        </div>
                        <div class="card-number">
                            <span id="view-num-bbva-main">...</span> 
                            <button class="copy-btn" onclick="copyText('view-num-bbva-main')">COPIAR</button>
                        </div>
                        <div class="card-bottom">
                            <div class="card-corner-left">
                                <span class="card-label">TITULAR</span>
                                <div class="card-holder" id="view-name-bbva-main">...</div>
                            </div>
                            <div class="card-corner-right">
                                <span class="card-label">BANCO</span>
                                <div class="card-holder">BBVA</div>
                            </div>
                        </div>
                    </div>

                    <div id="card-azteca-main" class="bank-card card-azteca">
                        <div class="card-top">
                            <img src="https://i.ibb.co/HLxnTK0r/Picsart-26-01-31-16-53-22-574.png" class="card-logo-bank-icon" style="filter: brightness(0) invert(1);">
                            <img src="https://i.ibb.co/HLxnTK0r/Picsart-26-01-31-16-53-22-574.png" class="card-logo-img">
                        </div>
                        <div class="card-number">
                            <span id="view-num-azteca-main">...</span> 
                            <button class="copy-btn" onclick="copyText('view-num-azteca-main')">COPIAR</button>
                        </div>
                        <div class="card-bottom">
                            <div class="card-corner-left">
                                <span class="card-label">TITULAR</span>
                                <div class="card-holder" id="view-name-azteca-main">...</div>
                            </div>
                            <div class="card-corner-right">
                                <span class="card-label">BANCO</span>
                                <div class="card-holder">AZTECA</div>
                            </div>
                        </div>
                    </div>

                    <div id="card-mp-main" class="bank-card card-mp">
                        <div class="card-top">
                            <img src="https://i.ibb.co/fGzfwpnB/Picsart-26-01-31-16-53-59-587.png" class="card-logo-bank-icon" style="filter: brightness(0) invert(1);">
                            <img src="https://i.ibb.co/fGzfwpnB/Picsart-26-01-31-16-53-59-587.png" class="card-logo-img">
                        </div>
                        <div class="card-number">
                            <span id="view-num-mp-main">...</span> 
                            <button class="copy-btn" onclick="copyText('view-num-mp-main')">COPIAR</button>
                        </div>
                        <div class="card-bottom">
                            <div class="card-corner-left">
                                <span class="card-label">TITULAR</span>
                                <div class="card-holder" id="view-name-mp-main">...</div>
                            </div>
                            <div class="card-corner-right">
                                <span class="card-label">BANCO</span>
                                <div class="card-holder">MERCADO PAGO</div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="card-oxxo-main" class="bank-card card-oxxo">
                        <div class="card-top">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/66/Oxxo_Logo.svg/1200px-Oxxo_Logo.svg.png" class="card-logo-bank-icon" style="background:white; border-radius:5px; padding:2px;">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/66/Oxxo_Logo.svg/1200px-Oxxo_Logo.svg.png" class="card-logo-img">
                        </div>
                        <div class="card-number">
                            <span id="view-num-oxxo-main">...</span> 
                            <button class="copy-btn" onclick="copyText('view-num-oxxo-main')">COPIAR</button>
                        </div>
                        <div class="card-bottom">
                            <div class="card-corner-left">
                                <span class="card-label">TITULAR</span>
                                <div class="card-holder" id="view-name-oxxo-main">...</div>
                            </div>
                            <div class="card-corner-right">
                                <span class="card-label">DEPÓSITO</span>
                                <div class="card-holder">OXXO</div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="card-banorte-main" class="bank-card card-banorte">
                        <div class="card-top">
                            <img src="https://i.ibb.co/qYLB0gBr/Picsart-26-01-31-16-50-59-086.png" class="card-logo-bank-icon" style="filter:brightness(0) invert(1);">
                            <img src="https://i.ibb.co/qYLB0gBr/Picsart-26-01-31-16-50-59-086.png" class="card-logo-img" style="filter:brightness(0) invert(1);">
                        </div>
                        <div class="card-number">
                            <span id="view-num-banorte-main">...</span> 
                            <button class="copy-btn" onclick="copyText('view-num-banorte-main')">COPIAR</button>
                        </div>
                        <div class="card-bottom">
                            <div class="card-corner-left">
                                <span class="card-label">TITULAR</span>
                                <div class="card-holder" id="view-name-banorte-main">...</div>
                            </div>
                            <div class="card-corner-right">
                                <span class="card-label">BANCO</span>
                                <div class="card-holder">BANORTE</div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="card-banamex-main" class="bank-card card-banamex">
                        <div class="card-top">
                            <img src="https://i.ibb.co/TBr6ks0n/Picsart-26-01-31-09-40-29-600.png" class="card-logo-bank-icon" style="filter:brightness(0) invert(1);">
                            <img src="https://i.ibb.co/TBr6ks0n/Picsart-26-01-31-09-40-29-600.png" class="card-logo-img" style="filter:brightness(0) invert(1);">
                        </div>
                        <div class="card-number">
                            <span id="view-num-banamex-main">...</span> 
                            <button class="copy-btn" onclick="copyText('view-num-banamex-main')">COPIAR</button>
                        </div>
                        <div class="card-bottom">
                            <div class="card-corner-left">
                                <span class="card-label">TITULAR</span>
                                <div class="card-holder" id="view-name-banamex-main">...</div>
                            </div>
                            <div class="card-corner-right">
                                <span class="card-label">BANCO</span>
                                <div class="card-holder">BANAMEX</div>
                            </div>
                        </div>
                    </div>
                </div>


                <button onclick="sendPaymentProof()" class="btn-action" style="margin-top:30px; display:inline-flex; align-items:center; justify-content:center; gap:10px; width:auto; background:#25D366; padding:15px 30px; border-radius:50px; font-size:1.1rem; border:none; color:white;">
                    <i class="fab fa-whatsapp" style="font-size:1.5rem;"></i> Enviar Comprobante
                </button>
            </div>
        </div>

        <div id="page-sorteos" class="page-view" style="display:none;">
            <div class="container">
                <h2 class="section-title">Sorteos Disponibles</h2>
                
                <div class="admin-clean-wrapper admin-only">
                    <button onclick="openEventModal()" class="btn-action" style="font-size:1.1rem; padding:15px 30px; background:var(--dark); color:var(--accent); border:1px solid var(--accent); box-shadow: 0 4px 15px rgba(0,0,0,0.3); border-radius: 50px;">
                        <i class="fas fa-plus-circle"></i> PUBLICAR NUEVO EVENTO
                    </button>
                </div>

                <div class="verifier-container">
                    <h4 style="color:var(--primary-dark); text-transform:uppercase; margin-bottom: 5px;">
                        <i class="fas fa-search" style="margin-right:5px;"></i> Verificador de Boletos
                    </h4>
                    <p style="font-size:0.9rem; color:#666; margin-bottom:15px;">
                        Ingresa tu número de celular para consultar tus boletos y estado de pago.
                    </p>
                    <input type="tel" id="verifier-phone" class="verifier-input" placeholder="Tu número de celular aquí">
                    <button onclick="verifyMyTickets()" class="btn-action" style="margin-top:15px; width:100%; background:var(--dark); padding:12px; font-size:1rem;">
                        VER MIS BOLETOS
                    </button>
                    <div id="verifier-result" style="margin-top:20px; text-align:left;"></div>
                </div>

                <div id="events-grid" class="events-grid">
                    <p style="text-align:center; width:100%; grid-column: 1 / -1; color: white;">Cargando eventos...</p>
                </div>
            </div>
        </div>

        <div id="page-boletos" class="page-view">
            
            <div id="selection-bar" class="selection-bar">
                <div class="selection-info">
                    <span id="bar-nums" style="color:var(--primary);">Ninguno</span> | <span id="bar-total">$0</span>
                </div>
                <button onclick="openFormModal()" class="btn-action" style="width:auto; margin:0; background:var(--accent); color:black;">
                    APARTAR <i class="fas fa-arrow-right"></i>
                </button>
            </div>

            <div class="container ticket-header">
                <button onclick="showPage('sorteos')" style="float:left; background:transparent; border:1px solid #ccc; padding:5px 10px; border-radius:20px; cursor:pointer; margin-bottom:10px;">
                    <i class="fas fa-arrow-left"></i> Volver a Sorteos
                </button>
                
                <button class="btn-action admin-only" onclick="shareCurrentEventLink()" style="float:right; margin-bottom:10px; background: #333; border:1px solid white;">
                    🔗 Copiar Link (Admin)
                </button>
                <div style="clear:both;"></div>

                <h1 id="header-title">Cargando...</h1>
                
                <div id="countdown-display" class="countdown-box">
                    <div class="cd-item"><div class="cd-num" id="cd-d">00</div><div class="cd-label">Días</div></div>
                    <div class="cd-item"><div class="cd-num" id="cd-h">00</div><div class="cd-label">Hrs</div></div>
                    <div class="cd-item"><div class="cd-num" id="cd-m">00</div><div class="cd-label">Min</div></div>
                    <div class="cd-item"><div class="cd-num" id="cd-s">00</div><div class="cd-label">Seg</div></div>
                </div>
                
                <div id="closed-msg" style="display:none; color:#ef4444; font-weight:900; font-size:1.5rem; margin-top:10px; text-transform:uppercase; animation:urgentPulse 2s infinite;">⛔ SORTEO CERRADO ⛔<br><span style="font-size:0.9rem; color:#666; font-weight:normal;">Esperando resultados...</span></div>

                <img id="header-img" src="" style="width:100%; max-height:300px; object-fit:contain; margin:15px 0; border-radius:10px; background:black; display:none;">
                
                <div class="progress-container public">
                    <div id="public-progress-bar" class="progress-bar"></div>
                </div>
                <div class="progress-text">
                    <span id="progress-percent-txt">0% Vendido</span>
                    <span id="progress-msg-txt">¡Tu suerte suma!</span>
                </div>

                <p id="header-desc">...</p>
                
                <div style="font-size:2rem; color:var(--primary); font-weight:900; margin-bottom:20px;">
                    <span id="header-price">$0</span> <span style="font-size:1rem; color:#666; font-weight:normal;">x boleto</span>
                </div>

                <div class="financial-panel">
                    <div class="stat-card">
                        <div class="stat-value stat-money" id="stat-raised">$0</div>
                        <div class="stat-label">Recaudado (Pagados)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value stat-pending" id="stat-pending">$0</div>
                        <div class="stat-label">Por Cobrar (Apartados)</div>
                    </div>
                </div>

                <button onclick="openLuckyModal()" class="btn-lucky">
                    <i class="fas fa-dice"></i> MÁQUINA DE LA SUERTE
                </button>

                <div class="search-container">
                    <input type="number" id="search-input" class="search-input" placeholder="Buscar número (Ej: 56)" oninput="highlightTicket(this.value)">
                    <i class="fas fa-search search-icon"></i>
                </div>

                <div class="leyenda">
                    <span class="badge" style="color:#28a745"><i class="fas fa-circle"></i> Libre</span>
                    <span class="badge" style="color:#ffc107"><i class="fas fa-circle"></i> Apartado</span>
                    <span class="badge" style="color:#dc3545"><i class="fas fa-circle"></i> Pagado</span>
                    <span class="badge" style="color:black"><i class="fas fa-circle"></i> Tuyo</span>
                </div>
                
                <div class="admin-controls admin-only" style="margin-top:20px;">
                     <button class="btn-action" style="width:100%; background:#333; margin-bottom:15px; border:1px solid var(--accent); padding: 15px;" onclick="openScreenshotModal()">
                        <i class="fas fa-camera"></i> GENERAR TABLA PARA FOTO
                     </button>
                     <div class="admin-title">🔔 NOTIFICACIONES (Este Evento)</div>
                     <div id="admin-notifications" class="admin-dashboard"></div>
                </div>
            </div>

            <div id="grid-rifa" class="grid-container">Cargando...</div>
        </div>

    </div> 
    
    <footer>
        <div class="footer-socials">
            <div style="display:inline-flex; align-items:center;">
                <a id="footer-fb-link" href="#" target="_blank" class="social-btn"><i class="fab fa-facebook-f"></i></a>
            </div>
            <div style="display:inline-flex; align-items:center; margin-left:15px;">
                <a id="footer-wa-link" href="#" target="_blank" class="social-btn"><i class="fab fa-whatsapp"></i></a>
            </div>
        </div>
        
        <p>&copy; 2026 Todos los derechos reservados.</p>
        
        <div style="margin-top:5px;">
            <a onclick="openTermsPublic()" class="footer-link">Ver Términos y Condiciones</a>
        </div>

        <div class="footer-dev">
            Esta página fue hecha por <a href="https://mancilla-dk.github.io/ZonaTecno/" target="_blank">ZonaTecno</a>
        </div>
    </footer>
    <script>
        // ==========================================
        // 1. CONFIGURACIÓN DE FIREBASE
        // ==========================================
        const firebaseConfig = {
            apiKey: "AIzaSyD5IfOyP599UgaKkZL6RDwv-6AwXwT51J4",
            authDomain: "rifaserick.firebaseapp.com",
            databaseURL: "https://rifaserick-default-rtdb.firebaseio.com",
            projectId: "rifaserick",
            storageBucket: "rifaserick.firebasestorage.app",
            messagingSenderId: "1059006672469",
            appId: "1:1059006672469:web:2a5aac116a060ff8016edc"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.database();
        const auth = firebase.auth();
        
        // ==========================================
        // 2. VARIABLES GLOBALES
        // ==========================================
        let siteConfig = {
            waOrders: "", 
            waChannel: "", 
            fbLink: "",
            theme: "default",
            terms: [], 
            faqs: [],
            texts: {}
        };
        
        let currentEventId = null; 
        let currentEventConfig = {}; 
        let currentEventTickets = {}; 
        let selected = [];
        let tempPicks = []; 
        let countdownInterval = null;
        let carouselData = { evidence: [] };
        let carouselIdx = { evidence: 0 };
        let isEventClosed = false; 

        // ==========================================
        // 3. INICIALIZACIÓN Y RUTAS
        // ==========================================
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            
            // Detector de Admin
            auth.onAuthStateChanged((user) => { 
                if (user) {
                    document.body.classList.add('is-admin'); 
                } else {
                    document.body.classList.remove('is-admin');
                }
            });

            // MODO: BOLETO DIGITAL (Vista Cliente)
            if(urlParams.get('viewTicket') === 'true') {
                activateOverlayMode('overlay-ticket');
                setTimeout(() => {
                    loadDigitalTicketMode(urlParams.get('id'), urlParams.get('num'));
                    removeSkeleton();
                }, 1000);
            
            // MODO: LINK DE PAGOS (Vista Cliente)
            } else if(urlParams.get('viewPayment') === 'true') {
                activateOverlayMode('overlay-payment');
                loadSiteConfig(); 
                db.ref('banks').on('value', (snap) => {
                    updateBankUI(snap.val() || {});
                    removeSkeleton();
                });
            
            // MODO: NORMAL APP
            } else {
                initAppNormal();
                const directEventId = urlParams.get('evt');
                if(directEventId) {
                    setTimeout(() => selectEvent(directEventId), 1000);
                }
                setTimeout(removeSkeleton, 1500); 
            }
        };

        function removeSkeleton() {
            const sk = document.getElementById('skeleton-loader');
            if(sk) {
                sk.style.opacity = '0';
                setTimeout(() => { sk.style.display = 'none'; }, 500);
            }
        }

        function activateOverlayMode(id) {
            document.querySelector('nav').style.display = 'none';
            document.querySelector('footer').style.display = 'none';
            document.getElementById('main-content-area').style.display = 'none';
            document.body.classList.add('exclusive-mode');
            const el = document.getElementById(id);
            if(el) el.classList.add('active');
        }

        function initAppNormal() {
            loadSiteConfig();
            db.ref('banks').on('value', (snap) => updateBankUI(snap.val() || {}));
            db.ref('images/evidence').on('value', (snap) => updateEvidenceUI(snap.val() || {}));
            db.ref('events').on('value', (snap) => renderEventsList(snap.val() || {}));
        }
        // ==========================================
        // 4. LÓGICA CMS (TEXTOS, BANCOS, CONFIG)
        // ==========================================
        function loadSiteConfig() {
            db.ref('site_config').on('value', (snap) => {
                const data = snap.val() || {};
                if(data.general) {
                    siteConfig.waOrders = data.general.waOrders || "";
                    siteConfig.waChannel = data.general.waChannel || "";
                    siteConfig.fbLink = data.general.fbLink || "";
                    applyTheme(data.general.theme || "default");
                    updateSocialLinksUI();
                }
                if(data.texts) {
                    siteConfig.texts = data.texts;
                    updateTextsUI();
                }
                siteConfig.terms = data.terms || [];
                siteConfig.faqs = data.faqs || [];
                renderFaqPublic();
            });
        }

        function updateSocialLinksUI() {
            const fbs = [document.getElementById('social-fb-nav'), document.getElementById('footer-fb-link')];
            const was = [document.getElementById('social-wa-nav'), document.getElementById('footer-wa-link')];
            fbs.forEach(e => { if(e) e.href = siteConfig.fbLink || "#"; });
            was.forEach(e => { if(e) e.href = siteConfig.waChannel || "#"; });
        }

        function applyTheme(t) {
            // Limpia temas anteriores y aplica el nuevo
            document.body.className = document.body.className.replace(/theme-\w+/g, "").trim();
            if(t !== 'default') document.body.classList.add(t);
            // Re-chequear modo admin
            if(auth.currentUser) document.body.classList.add('is-admin');
        }

        function updateTextsUI() {
            const t = siteConfig.texts || {};
            if(document.getElementById('view-hero-title')) document.getElementById('view-hero-title').innerText = t.heroTitle || "¡PARTICIPA Y GANA!";
            if(document.getElementById('view-hero-desc')) document.getElementById('view-hero-desc').innerText = t.heroDesc || "Tu oportunidad...";
            if(document.getElementById('view-bio-main')) document.getElementById('view-bio-main').innerText = t.bioMain || "Hola...";
            if(document.getElementById('view-bio-subtitle')) document.getElementById('view-bio-subtitle').innerText = t.bioSubtitle || "Tu Suerte Suma: Ganamos Todos";
            if(document.getElementById('view-bio-history')) document.getElementById('view-bio-history').innerText = t.bioHistory || "...";
            if(document.getElementById('view-bio-why')) document.getElementById('view-bio-why').innerText = t.bioWhy || "...";
        }

        // --- Funciones de Guardado CMS ---
        function openConfigTexts() { closeModal('modal-settings-menu'); const t = siteConfig.texts || {}; document.getElementById('txt-hero-title').value = t.heroTitle || ""; document.getElementById('txt-hero-desc').value = t.heroDesc || ""; document.getElementById('txt-bio-main').value = t.bioMain || ""; document.getElementById('txt-bio-subtitle').value = t.bioSubtitle || ""; document.getElementById('txt-bio-history').value = t.bioHistory || ""; document.getElementById('txt-bio-why').value = t.bioWhy || ""; document.getElementById('modal-config-texts').style.display='flex'; }
        function saveTextsConfig() { db.ref('site_config/texts').set({ heroTitle: document.getElementById('txt-hero-title').value, heroDesc: document.getElementById('txt-hero-desc').value, bioMain: document.getElementById('txt-bio-main').value, bioSubtitle: document.getElementById('txt-bio-subtitle').value, bioHistory: document.getElementById('txt-bio-history').value, bioWhy: document.getElementById('txt-bio-why').value }).then(()=>{ closeModal('modal-config-texts'); Swal.fire({toast:true, icon:'success', title:'Textos Actualizados'}); }); }
        
        function openConfigContact() { closeModal('modal-settings-menu'); document.getElementById('cfg-wa-orders').value = siteConfig.waOrders; document.getElementById('cfg-wa-channel').value = siteConfig.waChannel; document.getElementById('cfg-fb-link').value = siteConfig.fbLink; document.getElementById('modal-config-contact').style.display='flex'; }
        function saveContactConfig() { db.ref('site_config/general').update({ waOrders: document.getElementById('cfg-wa-orders').value, waChannel: document.getElementById('cfg-wa-channel').value, fbLink: document.getElementById('cfg-fb-link').value }).then(()=>{ closeModal('modal-config-contact'); Swal.fire({toast:true, icon:'success', title:'Guardado'}); }); }

        function openConfigTheme() { closeModal('modal-settings-menu'); document.getElementById('modal-config-theme').style.display='flex'; }
        function saveThemeConfig() { 
            // Detectar tema actual basado en la clase del body
            const classes = document.body.className.split(' ');
            const themeClass = classes.find(c => c.startsWith('theme-')) || 'default';
            db.ref('site_config/general/theme').set(themeClass).then(() => { closeModal('modal-config-theme'); Swal.fire({toast:true, icon:'success', title:'Tema Actualizado'}); }); 
        }

        // --- Lógica Bancos ---
        function updateBankUI(banks) {
             const list = ['bbva','azteca','mp','oxxo','banorte','banamex'];
             const overlayContainer = document.getElementById('payment-overlay-cards');
             if(overlayContainer) overlayContainer.innerHTML = ''; 

             list.forEach(k => {
                 const b = banks[k] || {};
                 const active = b.active;
                 
                 // 1. Vista Principal
                 const cardMain = document.getElementById(`card-${k}-main`);
                 if(cardMain) {
                     cardMain.classList.toggle('visible', !!active);
                     if(active) {
                         const nameEl = document.getElementById(`view-name-${k}-main`);
                         const numEl = document.getElementById(`view-num-${k}-main`);
                         if(nameEl) nameEl.innerText = b.name || "NO DEFINIDO";
                         if(numEl) numEl.innerText = b.num || "0000";

                         // 2. Vista Overlay (Link de Pagos)
                         if(overlayContainer) {
                             const clone = cardMain.cloneNode(true); 
                             clone.id = ""; 
                             clone.style.display = "flex"; 
                             clone.style.margin = "10px auto"; 
                             const btn = clone.querySelector('.copy-btn');
                             if(btn) {
                                 btn.onclick = function() { 
                                     navigator.clipboard.writeText(b.num || "").then(()=>Swal.fire({toast:true, icon:'success', title:'Copiado'}));
                                 };
                             }
                             overlayContainer.appendChild(clone);
                         }
                     }
                 }
                 // 3. Inputs Admin
                 if(document.body.classList.contains('is-admin')) {
                     let K = k.charAt(0).toUpperCase() + k.slice(1);
                     if(k=='bbva') K='BBVA'; if(k=='mp') K='MP'; 
                     const chk = document.getElementById('check'+K); if(chk) chk.checked = active;
                     const ni = document.getElementById('name'+K); if(ni) ni.value = b.name||'';
                     const nui = document.getElementById('num'+K); if(nui) nui.value = b.num||'';
                 }
             });
        }
        function saveBank(k) {
            let K = k.charAt(0).toUpperCase() + k.slice(1);
            if(k=='bbva') K='BBVA'; if(k=='mp') K='MP';
            const data = { name: document.getElementById('name'+K).value, num: document.getElementById('num'+K).value, active: document.getElementById('check'+K).checked };
            db.ref(`banks/${k}`).update(data).then(() => { Swal.fire({toast:true, icon:'success', title: K + ' Actualizado'}); });
        }

        // --- Auth ---
        function openLogin() { if(!document.body.classList.contains('is-admin')) document.getElementById('loginModal').style.display='flex'; }
        function attemptLogin() { auth.signInWithEmailAndPassword(document.getElementById('adminUser').value, document.getElementById('adminPass').value).then(()=>{ closeModal('loginModal'); Swal.fire({toast:true, icon:'success', title:'Bienvenido Admin'}); }).catch(()=>Swal.fire("Error","Credenciales incorrectas","error")); }
        function logoutAdmin() { auth.signOut().then(()=>location.reload()); }
        // ==========================================
        // 5. LÓGICA DE EVENTOS & CARRUSEL
        // ==========================================
        function renderEventsList(events) {
            const track = document.getElementById('home-events-track'); // Carrusel Inicio
            const grid = document.getElementById('events-grid'); // Lista Sorteos
            
            if(!track || !grid) return;
            track.innerHTML = ''; grid.innerHTML = '';
            
            if(!events || Object.keys(events).length === 0) {
                const msg = '<p style="text-align:center; color:white; width:100%;">No hay sorteos activos.</p>';
                track.innerHTML = msg; grid.innerHTML = msg; return;
            }

            const eventKeys = Object.keys(events);
            let cardsHTML = '';

            eventKeys.forEach(id => {
                const ev = events[id].config;
                // Formateo del tipo de rifa para mostrar
                let typeBadge = "";
                if(ev.type === "nacional") typeBadge = '<span style="font-size:0.7rem; background:#2563eb; color:white; padding:2px 6px; border-radius:4px; margin-right:5px;">LOTERÍA NACIONAL</span>';
                else if(ev.type === "tris") typeBadge = '<span style="font-size:0.7rem; background:#9333ea; color:white; padding:2px 6px; border-radius:4px; margin-right:5px;">TRIS</span>';
                else typeBadge = '<span style="font-size:0.7rem; background:#059669; color:white; padding:2px 6px; border-radius:4px; margin-right:5px;">ENTRE AMIGOS</span>';

                const html = `
                    <div class="event-card" onclick="selectEvent('${id}')">
                        <div class="btn-edit-floating admin-only" onclick="event.stopPropagation(); openEditEvent('${id}')">
                            <i class="fas fa-pencil-alt"></i>
                        </div>
                        <img src="${ev.img || 'https://via.placeholder.com/300'}" class="event-img">
                        <div class="event-body">
                            <div>
                                <div style="margin-bottom:5px;">${typeBadge}</div>
                                <div class="event-title">${ev.title}</div>
                                <div class="event-desc">${ev.descShort || ''}</div>
                            </div>
                            <div>
                                <div class="event-price">$${ev.price}</div>
                                <button class="btn-action" style="width:100%; margin-top:10px;">VER BOLETOS</button>
                            </div>
                        </div>
                    </div>`;
                cardsHTML += html;
            });

            // 1. Llenar Grid (Sorteos Page)
            grid.innerHTML = cardsHTML;

            // 2. Llenar Carrusel (Inicio Page)
            track.innerHTML = cardsHTML;

            // 3. Verificar flechas del carrusel
            setTimeout(() => { checkCarouselArrows(); }, 500);
        }

        function scrollHomeCarousel(direction) {
            const container = document.getElementById('home-events-scroll-area');
            const cardWidth = 300; 
            if(container) {
                container.scrollBy({ left: direction * cardWidth, behavior: 'smooth' });
            }
        }

        function checkCarouselArrows() {
            const container = document.getElementById('home-events-scroll-area');
            const prevBtn = document.getElementById('home-prev-btn');
            const nextBtn = document.getElementById('home-next-btn');
            if(!container || !prevBtn || !nextBtn) return;

            if (container.scrollWidth > container.clientWidth) {
                prevBtn.style.display = 'flex';
                nextBtn.style.display = 'flex';
            } else {
                prevBtn.style.display = 'none';
                nextBtn.style.display = 'none';
                document.getElementById('home-events-track').style.justifyContent = 'center';
            }
        }

        // --- FAQ & Terms Helper Logic ---
        function openFaqEditor() { closeModal('modal-settings-menu'); renderFaqEditor(); document.getElementById('modal-editor-faq').style.display='flex'; }
        function renderFaqEditor() { const c=document.getElementById('cms-faq-list-container'); c.innerHTML=''; (siteConfig.faqs||[]).forEach((f,i)=>{ const d=document.createElement('div'); d.className='cms-term-item'; d.innerHTML=`<div class="cms-term-delete" onclick="delFaq(${i})">&times;</div><input class="cms-input-sm fq" value="${f.q}"><textarea class="cms-input-sm fa">${f.a}</textarea>`; c.appendChild(d); }); }
        function addFaqBlockUI() { if(!siteConfig.faqs) siteConfig.faqs=[]; siteConfig.faqs.push({q:'',a:''}); renderFaqEditor(); }
        function delFaq(i) { siteConfig.faqs.splice(i,1); renderFaqEditor(); }
        function saveFaqConfig() { const qs=document.querySelectorAll('.fq'); const as=document.querySelectorAll('.fa'); const arr=[]; qs.forEach((q,i)=>{ if(q.value) arr.push({q:q.value, a:as[i].value}); }); db.ref('site_config/faqs').set(arr).then(()=>{ closeModal('modal-editor-faq'); Swal.fire({toast:true, icon:'success', title:'FAQ Guardadas'}); }); }
        function renderFaqPublic() { const c=document.getElementById('faq-list-public'); if(!c)return; c.innerHTML=(siteConfig.faqs||[]).map((f,i)=>`<details><summary>${i+1}. ${f.q}</summary><div class="faq-ans">${f.a}</div></details>`).join(''); }

        function openTermsEditor() { closeModal('modal-settings-menu'); renderTermsEditor(); document.getElementById('modal-editor-terms').style.display = 'flex'; }
        function renderTermsEditor() { const c = document.getElementById('cms-terms-list-container'); c.innerHTML = ''; (siteConfig.terms || []).forEach((t, i) => { const d = document.createElement('div'); d.className = 'cms-term-item'; d.innerHTML = `<div class="cms-term-delete" onclick="delTerm(${i})">&times;</div><input class="cms-input-sm tt" value="${t.title}" placeholder="Título"><textarea class="cms-input-sm td">${t.desc}</textarea>`; c.appendChild(d); }); }
        function addTermBlockUI() { if(!siteConfig.terms) siteConfig.terms=[]; siteConfig.terms.push({title:'',desc:''}); renderTermsEditor(); }
        function delTerm(i) { siteConfig.terms.splice(i,1); renderTermsEditor(); }
        function saveTermsConfig() { const titles = document.querySelectorAll('.tt'); const descs = document.querySelectorAll('.td'); const arr=[]; titles.forEach((t,i) => { if(t.value) arr.push({title:t.value, desc:descs[i].value}); }); db.ref('site_config/terms').set(arr).then(()=>{ closeModal('modal-editor-terms'); Swal.fire({toast:true, icon:'success', title:'Términos Guardados'}); }); }
        function openTermsPublic() { const c = document.getElementById('terms-public-content'); if(!siteConfig.terms || siteConfig.terms.length === 0) c.innerHTML = '<p style="text-align:center;">Sin términos registrados.</p>'; else c.innerHTML = siteConfig.terms.map(t => `<div style="margin-bottom:15px;"><strong>${t.title}</strong><p>${t.desc}</p></div>`).join(''); document.getElementById('modal-terms').style.display = 'flex'; }

        // ==========================================
        // 6. GESTIÓN DE EVENTO SELECCIONADO
        // ==========================================
        function selectEvent(id) {
            currentEventId = id;
            selected = [];
            isEventClosed = false; 
            updateBar();
            
            db.ref(`events/${id}`).on('value', (snap) => {
                const d = snap.val();
                if(!d) return;
                currentEventConfig = d.config;
                currentEventTickets = d.tickets || {};
                
                document.getElementById('header-title').innerText = currentEventConfig.title;
                document.getElementById('header-price').innerText = `$${currentEventConfig.price}`;
                document.getElementById('header-desc').innerText = currentEventConfig.descLong || "";
                
                const img = document.getElementById('header-img');
                if(currentEventConfig.img) { img.src = currentEventConfig.img; img.style.display='block'; } 
                else { img.style.display='none'; }
                
                startCountdown(currentEventConfig.dateEnd);
                updateFinancialPanel(); 
                createGrid(); 
                
                if(document.body.classList.contains('is-admin')) renderGroupedNotifications();
                
                removeSkeleton();
            });
            showPage('boletos');
        }

        function startCountdown(date) {
            if(countdownInterval) clearInterval(countdownInterval);
            const disp = document.getElementById('countdown-display');
            const msg = document.getElementById('closed-msg');
            if(!date) { disp.style.display='none'; msg.style.display='none'; return; }
            
            const end = new Date(date).getTime();
            if(isNaN(end)) { disp.style.display='none'; return; }
            
            disp.style.display='flex';
            msg.style.display='none';
            isEventClosed = false;

            countdownInterval = setInterval(() => {
                const now = new Date().getTime();
                const d = end - now;
                if(d < 0) { 
                    clearInterval(countdownInterval); disp.style.display='none';
                    msg.style.display='block'; isEventClosed = true; createGrid(); return; 
                }
                document.getElementById("cd-d").innerText = Math.floor(d/(1000*60*60*24)).toString().padStart(2,'0');
                document.getElementById("cd-h").innerText = Math.floor((d%(1000*60*60*24))/(1000*60*60)).toString().padStart(2,'0');
                document.getElementById("cd-m").innerText = Math.floor((d%(1000*60*60))/(1000*60)).toString().padStart(2,'0');
                document.getElementById("cd-s").innerText = Math.floor((d%(1000*60))/1000).toString().padStart(2,'0');
            }, 1000);
        }

        // ==========================================
        // 7. LÓGICA DE ADMIN (PAGOS Y NOTIFICACIONES)
        // ==========================================
        function renderGroupedNotifications() { 
            const c=document.getElementById('admin-notifications'); 
            if(!c) return; c.innerHTML=''; 
            const groups = {};
            if(currentEventTickets) {
                Object.entries(currentEventTickets).forEach(([idx, ticket]) => {
                    if(ticket.status === 'apartado') {
                        if(!groups[ticket.phone]) groups[ticket.phone] = { name: ticket.owner, idxs: [] };
                        groups[ticket.phone].idxs.push(idx);
                    }
                });
            }
            if(Object.keys(groups).length === 0) { c.innerHTML='<p style="text-align:center; color:#999;">Sin apartados pendientes.</p>'; return; }
            Object.entries(groups).forEach(([phone, dat]) => {
                let displayNums = dat.idxs.map(i => `#${parseInt(i)+1}`).join(', ');
                if(displayNums.length > 20) displayNums = displayNums.substring(0, 20) + "...";

                c.innerHTML += `
                <div class="admin-group-card">
                    <div class="group-header">
                        <div>
                            <h4 style="margin:0;">${dat.name}</h4>
                            <small>${phone}</small>
                        </div>
                    </div>
                    <div style="font-size:0.8rem; color:#666; margin-bottom:5px;">${displayNums}</div>
                    <div style="display:flex; justify-content:end; gap:5px;">
                        <button class="btn-small btn-free" onclick="freeG('${phone}')">LIBERAR</button>
                        <button class="btn-small btn-approve" onclick="payG('${phone}')">PAGADO</button>
                    </div>
                </div>`;
            });
        }

        function freeG(phone) { 
            Swal.fire({
                title: '¿Liberar boletos?', text: "Se borrarán los apartados de este número.", icon: 'warning', showCancelButton: true, confirmButtonText: 'Sí, liberar'
            }).then((result) => {
                if (result.isConfirmed) {
                    const updates={}; 
                    Object.entries(currentEventTickets).forEach(([i, t]) => { 
                        if(t.phone === phone && t.status === 'apartado') updates[`events/${currentEventId}/tickets/${i}`] = null; 
                    }); 
                    db.ref().update(updates).then(()=>{ Swal.fire({toast:true,icon:'info',title:'Grupo liberado'}); }); 
                }
            });
        }

        function payG(phone) { 
            const updates={}; 
            let affectedTickets = [];
            Object.entries(currentEventTickets).forEach(([i, t]) => { 
                if(t.phone === phone && t.status === 'apartado') {
                    updates[`events/${currentEventId}/tickets/${i}/status`] = 'pagado';
                    affectedTickets.push(i);
                }
            }); 
            db.ref().update(updates).then(()=>{ openPaymentSuccessModal(phone, affectedTickets); }); 
        }

        function openPaymentSuccessModal(phone, tickets) {
            document.getElementById('success-target-phone').value = phone;
            document.getElementById('success-target-tickets').value = JSON.stringify(tickets);
            document.getElementById('modal-payment-success').style.display = 'flex';
        }

        function sendConfirmationToClient() {
            const phone = document.getElementById('success-target-phone').value;
            const ticketsStr = document.getElementById('success-target-tickets').value;
            const tickets = JSON.parse(ticketsStr || "[]");
            if(!phone || tickets.length === 0) return;

            const firstT = currentEventTickets[tickets[0]];
            const name = firstT.owner || "Cliente";

            const totalBoletos = parseInt(currentEventConfig.qty || 100);
            let baseNums = (totalBoletos <= 100) ? 100 : totalBoletos;
            let rangeSize = Math.floor(baseNums / totalBoletos);
            let pad = (baseNums > 100) ? (baseNums > 1000 ? 4 : 3) : 2;
            
            let numMsg = "";
            if(rangeSize > 1) {
                numMsg = tickets.map(n => `#${parseInt(n)+1}`).join(", ");
            } else {
                numMsg = tickets.map(n => n.toString().padStart(pad,'0')).join(", ");
            }

            const linkBase = window.location.href.split('?')[0];
            const digitalLink = `${linkBase}?viewTicket=true&id=${currentEventId}&num=${tickets[0]}`;
            const fb = siteConfig.fbLink || "Facebook";
            const waChannel = siteConfig.waChannel || "Canal";

            // MENSAJE PERSONALIZADO SOLICITADO
            const msg = `🌟 ¡FELICIDADES, ${name}! 🌟\n\n¡Excelente noticia! 🎉 Tu participación en el Gran Sorteo ${currentEventConfig.title} ha sido confirmada con éxito. ✅\n\n🎫 Números Oficiales Asignados:\n👉 ${numMsg}\n\n🍀 Te enviamos la mejor de las suertes y toda la buena vibra. Gracias por confiar y ser parte de esta experiencia donde tu suerte también suma. 🙌✨\n\n👇 Accede aquí a tu Boleto Digital Oficial\n(Guárdalo y consérvalo para cualquier consulta):\n🔗\n${digitalLink} \n\n📡 Mantente al tanto de novedades, resultados y próximos sorteos:\n\nFacebook ${fb}\n\nWhatsApp ${waChannel}\n\n✨Mucho éxito y gracias por participar ✨`;
            
            window.open(`https://wa.me/${phone}?text=${encodeURIComponent(msg)}`, '_blank');
            closeModal('modal-payment-success');
        }

        // ==========================================
        // 8. GENERACIÓN DE GRILLA
        // ==========================================
        function createGrid() {
            const grid = document.getElementById('grid-rifa');
            grid.innerHTML = '';
            
            if (isEventClosed) grid.classList.add('locked'); 
            else grid.classList.remove('locked');
            
            const totalBoletos = parseInt(currentEventConfig.qty || 100);
            let baseNums = (totalBoletos <= 100) ? 100 : totalBoletos;
            let rangeSize = Math.floor(baseNums / totalBoletos);
            let pad = (baseNums > 100) ? (baseNums > 1000 ? 4 : 3) : 2;

            for(let i=0; i<totalBoletos; i++) {
                let d = document.createElement('div');
                d.className = 'ticket';
                d.id = 't-'+i;
                d.onclick = () => clickTicket(i);

                if(rangeSize > 1) {
                    let start = i * rangeSize;
                    let end = start + rangeSize - 1;
                    let startStr = start.toString().padStart(pad, '0');
                    let endStr = end.toString().padStart(pad, '0');
                    d.innerHTML = `<span style="font-size:1.3rem;">${i+1}</span><br><span style="font-size:0.7rem; opacity:0.8;">(${startStr}-${endStr})</span>`;
                    d.classList.add('range-text');
                } else {
                    d.innerText = i.toString().padStart(pad, '0');
                }

                if(currentEventTickets[i]) d.classList.add(currentEventTickets[i].status);
                else if(selected.includes(i)) d.classList.add('selected');
                else d.classList.add('disponible');

                grid.appendChild(d);
            }
        }

        function clickTicket(i) {
            if (isEventClosed && !document.body.classList.contains('is-admin')) return Swal.fire("Sorteo Cerrado", "Ya no se pueden seleccionar boletos.", "info");
            
            if(document.body.classList.contains('is-admin') && currentEventTickets[i]) { 
                openAdminTicket(i); 
                return; 
            }
            if(currentEventTickets[i]) return;
            
            if(selected.includes(i)) {
                selected = selected.filter(n => n!==i);
                document.getElementById('t-'+i).classList.remove('selected');
                document.getElementById('t-'+i).classList.add('disponible');
            } else {
                selected.push(i);
                document.getElementById('t-'+i).classList.remove('disponible');
                document.getElementById('t-'+i).classList.add('selected');
            }
            updateBar();
        }

        function openAdminTicket(i) {
             window.targetTicketIdx = i;
             const t = currentEventTickets[i];
             if(!t) return;

             document.getElementById('adm-ticket-num').innerText = (parseInt(i)+1);
             document.getElementById('adm-client').innerText = t.owner || "Sin Nombre";
             document.getElementById('adm-phone').innerText = t.phone || "Sin Teléfono";
             document.getElementById('adm-state').innerText = t.state || "No especificado"; 
             const statusEl = document.getElementById('adm-status');
             statusEl.innerText = t.status.toUpperCase();
             statusEl.style.color = (t.status === 'pagado') ? '#28a745' : '#ffc107';
             document.getElementById('adm-wa-link').href = `https://wa.me/${t.phone}`;

             let userTickets = [];
             Object.entries(currentEventTickets).forEach(([idx, ticketData]) => {
                 if (ticketData.phone === t.phone) userTickets.push(`#${parseInt(idx)+1}`);
             });
             document.getElementById('adm-all-tickets').innerText = userTickets.join(", ");
             document.getElementById('modal-admin-ticket').style.display='flex';
        }

        function changeStatus(s) {
            const i = window.targetTicketIdx;
            if(!currentEventId || i === undefined) return;
            
            if(s==='disponible') {
                Swal.fire({
                    title: '¿Eliminar boleto?', text: "Esta acción liberará el boleto.", icon: 'warning', showCancelButton: true, confirmButtonColor: '#d33', confirmButtonText: 'Sí, liberar'
                }).then((r) => {
                    if(r.isConfirmed) {
                        db.ref(`events/${currentEventId}/tickets/${i}`).remove()
                        .then(() => { closeModal('modal-admin-ticket'); Swal.fire({toast:true, icon:'info', title:'Boleto Liberado'}); });
                    }
                });
            }
        }

        function updateBar() {
            const bar = document.getElementById('selection-bar');
            if(selected.length > 0) {
                bar.classList.add('active');
                
                const totalBoletos = parseInt(currentEventConfig.qty || 100);
                let baseNums = (totalBoletos <= 100) ? 100 : totalBoletos;
                let rangeSize = Math.floor(baseNums / totalBoletos);
                let displayTxt = "";
                
                if(rangeSize > 1) {
                    displayTxt = selected.map(n => `#${n+1}`).join(', ');
                } else {
                    let pad = (baseNums > 100) ? (baseNums > 1000 ? 4 : 3) : 2;
                    displayTxt = selected.map(n => n.toString().padStart(pad, '0')).join(', ');
                }
                
                document.getElementById('bar-nums').innerText = displayTxt;
                document.getElementById('bar-total').innerText = `$${selected.length * currentEventConfig.price}`;
            } else {
                bar.classList.remove('active');
            }
        }

        // ==========================================
        // 9. FORMULARIO Y ENVÍO WHATSAPP (CLIENTE)
        // ==========================================
        function openFormModal() {
            if(isEventClosed) return Swal.fire("Cerrado", "El sorteo ha finalizado.", "error");
            document.getElementById('form-total').innerText = `$${selected.length * currentEventConfig.price}`;
            
            const totalBoletos = parseInt(currentEventConfig.qty || 100);
            let baseNums = (totalBoletos <= 100) ? 100 : totalBoletos;
            let rangeSize = Math.floor(baseNums / totalBoletos);
            let displayTxt = "";
            
            if(rangeSize > 1) displayTxt = selected.map(n => `#${n+1}`).join(', ');
            else {
                let pad = (baseNums > 100) ? (baseNums > 1000 ? 4 : 3) : 2;
                displayTxt = selected.map(n => n.toString().padStart(pad, '0')).join(', ');
            }
            
            document.getElementById('form-nums').innerText = displayTxt;
            document.getElementById('modal-form').style.display='flex';
        }

        function sendWhatsApp() {
            const name = document.getElementById('user-name').value;
            const phone = document.getElementById('user-phone').value;
            const state = document.getElementById('user-state').value;
            
            if(!name || !phone || !state) return Swal.fire("Error","Llena todos los campos","warning");
            
            const updates = {};
            const now = new Date().toISOString();
            
            selected.forEach(i => {
                updates[`events/${currentEventId}/tickets/${i}`] = { status:'apartado', owner:name, phone:phone, state:state, date:now };
            });
            
            db.ref().update(updates).then(() => {
                const totalBoletos = parseInt(currentEventConfig.qty || 100);
                let baseNums = (totalBoletos <= 100) ? 100 : totalBoletos;
                let rangeSize = Math.floor(baseNums / totalBoletos);
                let pad = (baseNums > 100) ? (baseNums > 1000 ? 4 : 3) : 2;
                let numMsg = "";
                
                if(rangeSize > 1) {
                    numMsg = selected.map(n => {
                        let start = n * rangeSize;
                        let end = start + rangeSize - 1;
                        return `Boleto #${n+1} (Nums: ${start.toString().padStart(pad,'0')}-${end.toString().padStart(pad,'0')})`;
                    }).join('\n');
                } else {
                    numMsg = selected.map(n => n.toString().padStart(pad,'0')).join(', ');
                }
                
                const total = selected.length * currentEventConfig.price;
                const txt = `👋 Hola, buen día. Mi nombre es ${name} y me comunico desde el estado de ${state}.\n🎉 Deseo participar en el evento “${currentEventConfig.title}”.\n\n🎫 Números seleccionados:\n${numMsg}\n\n💰 Total a pagar: $${total}\n📱 Número de contacto: ${phone}.\n\nQuedo atento a que me compartan los datos de pago para confirmar mi apartado. ¡Gracias! ✨`;
                
                window.open(`https://wa.me/${siteConfig.waOrders}?text=${encodeURIComponent(txt)}`, '_blank');
                
                selected=[]; updateBar(); closeModal('modal-form'); showPage('pagos');
            });
        }

        // ==========================================
        // 10. FUNCIONES EXTRA (CORREGIDAS Y MEJORADAS)
        // ==========================================
        
        // FEATURE 1: VERIFICADOR PROFESIONAL
        function verifyMyTickets() {
            const phoneInput = document.getElementById('verifier-phone').value.trim();
            const resultDiv = document.getElementById('verifier-result');
            resultDiv.innerHTML = '<p style="text-align:center; color:#666;">Buscando en la base de datos...</p>';
            
            if(!phoneInput) { resultDiv.innerHTML = '<p style="color:#ef4444; text-align:center; font-weight:bold;">⚠️ Ingresa un número válido.</p>'; return; }
            
            db.ref('events').once('value').then(snap => {
                const allEvents = snap.val() || {};
                let found = [];

                Object.entries(allEvents).forEach(([evtId, evtData]) => {
                    const tickets = evtData.tickets || {};
                    const config = evtData.config || {};
                    const totalBoletos = parseInt(config.qty || 100);
                    let baseNums = (totalBoletos <= 100) ? 100 : totalBoletos;
                    let rangeSize = Math.floor(baseNums / totalBoletos);
                    let pad = (baseNums > 100) ? (baseNums > 1000 ? 4 : 3) : 2;

                    Object.entries(tickets).forEach(([ticketIdx, tData]) => {
                        if(tData.phone && tData.phone.includes(phoneInput)) {
                            let displayNum = "";
                            if(rangeSize > 1) displayNum = `#${parseInt(ticketIdx)+1}`;
                            else displayNum = ticketIdx.toString().padStart(pad,'0');
                            
                            found.push({ eventName: config.title, num: displayNum, status: tData.status });
                        }
                    });
                });

                if(found.length === 0) {
                    resultDiv.innerHTML = '<p style="color:#666; text-align:center;">🚫 No encontramos boletos asociados a ese número.</p>';
                } else {
                    let html = '<div style="background:white; border-radius:10px; overflow:hidden; border:1px solid #eee;">';
                    found.forEach(item => {
                        let color = item.status === 'pagado' ? '#28a745' : '#ffc107';
                        let icon = item.status === 'pagado' ? '<i class="fas fa-check-circle"></i>' : '<i class="fas fa-clock"></i>';
                        let statusTxt = item.status === 'pagado' ? 'PAGADO' : 'APARTADO';
                        
                        html += `
                        <div style="padding:15px; border-bottom:1px solid #f0f0f0; display:flex; align-items:center; justify-content:space-between;">
                            <div>
                                <div style="font-weight:900; font-size:1.1rem; color:var(--dark);">Boleto ${item.num}</div>
                                <div style="font-size:0.8rem; color:#666;">${item.eventName}</div>
                            </div>
                            <div style="background:${color}; color:white; padding:5px 10px; border-radius:20px; font-size:0.75rem; font-weight:bold;">
                                ${icon} ${statusTxt}
                            </div>
                        </div>`;
                    });
                    html += '</div>';
                    resultDiv.innerHTML = html;
                }
            });
        }

        // FEATURE 2: CORRECCIÓN BOTÓN COMPROBANTE DE PAGO
        function sendPaymentProof() { 
            const wa = siteConfig.waOrders;
            if(!wa) {
                Swal.fire("Aviso", "El número de WhatsApp no está configurado por el administrador.", "info");
                return;
            }
            const msg = "Hola, he realizado el pago de mis boletos. Adjunto mi comprobante para confirmar mi participación."; 
            window.open(`https://wa.me/${wa}?text=${encodeURIComponent(msg)}`, '_blank'); 
        }

        function updateFinancialPanel() {
            let sold=0, pending=0;
            if(currentEventTickets) {
                Object.values(currentEventTickets).forEach(t => {
                    if(t.status==='pagado') sold++;
                    else if(t.status==='apartado') pending++;
                });
            }
            const price = parseFloat(currentEventConfig.price || 0);
            document.getElementById('stat-raised').innerText = `$${(sold*price).toLocaleString()}`;
            document.getElementById('stat-pending').innerText = `$${(pending*price).toLocaleString()}`;
            
            const total = parseInt(currentEventConfig.qty || 100);
            const pct = Math.floor((sold/total)*100);
            const pBar = document.getElementById('public-progress-bar');
            const pTxt = document.getElementById('progress-percent-txt');
            pBar.style.width = pct+'%';
            pTxt.innerText = pct+'% Vendido';
            if(pct >= 100) { pBar.classList.add('sold-out'); pTxt.innerText = "¡BOLETOS AGOTADOS!"; pTxt.style.color = "#dc3545"; } 
            else { pBar.classList.remove('sold-out'); pTxt.style.color = "#666"; }
        }

        function highlightTicket(val) {
            if(!val) return;
            let target = document.getElementById('t-'+parseInt(val));
            if(!target) target = document.getElementById('t-'+(parseInt(val)-1)); // Fix por si acaso
            
            if(target) {
                target.scrollIntoView({behavior:'smooth', block:'center'});
                target.style.border='3px solid var(--accent)'; target.style.transform='scale(1.2)'; target.style.zIndex='100';
                setTimeout(()=>{ target.style.border=''; target.style.transform='scale(1)'; target.style.zIndex='1'; }, 2000);
            }
        }

        function loadDigitalTicketMode(evtId, numRaw) {
            db.ref(`events/${evtId}`).once('value').then(snap => {
                const data = snap.val();
                if(!data) { document.body.innerHTML = "<h2 style='color:white; text-align:center; padding:50px;'>Evento finalizado o no existe.</h2>"; return; }
                const config = data.config;
                const ticketData = data.tickets ? data.tickets[numRaw] : null;
                
                if(!ticketData) { document.body.innerHTML = "<h2 style='color:white; text-align:center; padding:50px;'>Boleto no encontrado.</h2>"; return; }

                document.getElementById('vt-link-client').innerText = ticketData.owner;
                document.getElementById('vt-link-state').innerText = ticketData.state || "";
                document.getElementById('vt-link-event-name').innerText = config.title;
                const imgEl = document.getElementById('vt-link-img');
                if(config.img) { imgEl.src = config.img; imgEl.style.display = 'block'; }
                
                let myNumbers = [];
                const totalBoletos = parseInt(config.qty || 100);
                let baseNums = (totalBoletos <= 100) ? 100 : totalBoletos;
                let rangeSize = Math.floor(baseNums / totalBoletos);
                let pad = (baseNums > 100) ? (baseNums > 1000 ? 4 : 3) : 2;

                Object.entries(data.tickets).forEach(([idx, t]) => {
                    if(t.phone === ticketData.phone) {
                        if(rangeSize > 1) {
                            myNumbers.push(`#${parseInt(idx)+1}`);
                        } else {
                            myNumbers.push(idx.toString().padStart(pad,'0'));
                        }
                    }
                });
                
                myNumbers.sort((a,b) => {
                    let numA = parseInt(a.replace('#',''));
                    let numB = parseInt(b.replace('#',''));
                    return numA - numB;
                });

                const container = document.getElementById('vt-link-num');
                if(myNumbers.length > 8) container.classList.add('small-text');
                container.innerText = myNumbers.join(", ");
            });
        }

        // Utils Generales
        function shareCurrentEventLink() { if(!currentEventId) return; const link = window.location.href.split('?')[0]+"?evt="+currentEventId; navigator.clipboard.writeText(link).then(()=>Swal.fire({toast:true, icon:'success', title:'Link Copiado'})); }
        function sharePaymentLink() { const link = window.location.href.split('?')[0]+"?viewPayment=true"; navigator.clipboard.writeText(link).then(()=>Swal.fire({toast:true, icon:'success', title:'Enlace Copiado'})); }
        function shareTicketWhatsApp() { const txt = `Hola! Aquí está tu boleto digital:\nEvento: ${document.getElementById('vt-event-name').innerText}\nNúmeros: ${document.getElementById('vt-link-num').innerText}\nGracias por participar!`; window.open(`https://wa.me/?text=${encodeURIComponent(txt)}`, '_blank'); }
        function showPage(id) { document.querySelectorAll('.page-view').forEach(p => p.style.display = 'none'); document.getElementById('page-'+id).style.display = 'block'; window.scrollTo({top:0, behavior:'smooth'}); }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        function openSettingsMenu() { document.getElementById('modal-settings-menu').style.display = 'flex'; }
        function copyText(id) { navigator.clipboard.writeText(document.getElementById(id).innerText).then(()=>Swal.fire({toast:true, icon:'success', title:'Copiado'})); }
        
                /* --- REEMPLAZAR ESTA FUNCIÓN COMPLETA --- */
        function openScreenshotModal() {
            const t = document.getElementById('screenshot-grid-target'); t.innerHTML='';
            const total = parseInt(currentEventConfig.qty || 100);
            
            for(let i=0; i<total; i++) {
                const d = document.createElement('div'); 
                d.className='screenshot-cell';
                
                // CAMBIO CLAVE: Escribimos el número SIEMPRE, antes de checar el estado
                d.innerText = (i+1); 

                const tick = currentEventTickets[i];
                if(tick) {
                    // Si está pagado o apartado, asignamos su color, pero el número ya está puesto
                    if(tick.status==='pagado') d.classList.add('ss-paid');
                    else d.classList.add('ss-reserved'); 
                } else { 
                    d.classList.add('ss-free'); 
                }
                t.appendChild(d);
            }
            
            document.getElementById('ss-event-title').innerText = currentEventConfig.title;
            document.getElementById('modal-screenshot').style.display='flex';
        }


        // CRUD Eventos & Slot
        function addImage(type) { const url = document.getElementById('imgEvidenceInput').value; if(url) db.ref('images/evidence').push({url}).then(() => Swal.fire({toast:true, icon:'success', title:'Imagen subida'})); }
        function updateEvidenceUI(images) {
            const w = document.getElementById('evidenceCarouselImgWrapper'); const list = document.getElementById('evidenceImgList');
            if(!w) return; w.innerHTML = ''; list.innerHTML = ''; carouselData.evidence = [];
            Object.entries(images).forEach(([key, val]) => { carouselData.evidence.push(val.url); w.innerHTML += `<img src="${val.url}">`; list.innerHTML += `<div class="admin-img-item"><span>Img...${key.substr(-4)}</span><span onclick="db.ref('images/evidence/${key}').remove()" style="color:red;cursor:pointer;">&times;</span></div>`; });
            if(carouselData.evidence.length > 0) w.children[0].style.display = 'block'; else w.innerHTML = '<p style="text-align:center; padding:50px;">Sin evidencia aún.</p>';
        }
        function moveCarousel(type, dir) { const w = document.getElementById(type+'CarouselImgWrapper'); const imgs = w.querySelectorAll('img'); if(imgs.length === 0) return; imgs[carouselIdx[type]].style.display = 'none'; carouselIdx[type] += dir; if(carouselIdx[type] >= imgs.length) carouselIdx[type] = 0; if(carouselIdx[type] < 0) carouselIdx[type] = imgs.length - 1; imgs[carouselIdx[type]].style.display = 'block'; }

        function openEventModal() { document.getElementById('edit-event-id').value=''; document.getElementById('evt-title').value=''; document.getElementById('evt-price').value=''; document.getElementById('evt-qty').value='100'; document.getElementById('evt-img').value=''; document.getElementById('evt-desc-short').value=''; document.getElementById('evt-desc-long').value=''; document.getElementById('evt-date-end').value=''; document.getElementById('btn-delete-event').style.display='none'; document.getElementById('modal-event-config').style.display='flex'; }
        
        function openEditEvent(id) { 
            db.ref(`events/${id}/config`).once('value').then(s=>{ 
                const c = s.val(); 
                document.getElementById('edit-event-id').value=id; 
                document.getElementById('evt-title').value=c.title; 
                document.getElementById('evt-price').value=c.price; 
                document.getElementById('evt-qty').value=c.qty || '100'; 
                document.getElementById('evt-type').value=c.type || 'amigos'; 
                document.getElementById('evt-img').value=c.img; 
                document.getElementById('evt-desc-short').value=c.descShort; 
                document.getElementById('evt-desc-long').value=c.descLong; 
                document.getElementById('evt-date-end').value=c.dateEnd||''; 
                document.getElementById('btn-delete-event').style.display='inline-block'; 
                document.getElementById('modal-event-config').style.display='flex'; 
            }); 
        }

        function saveEventConfig() { 
            const id = document.getElementById('edit-event-id').value; 
            const config = { 
                title: document.getElementById('evt-title').value, 
                price: document.getElementById('evt-price').value, 
                qty: document.getElementById('evt-qty').value, 
                type: document.getElementById('evt-type').value, 
                img: document.getElementById('evt-img').value, 
                descShort: document.getElementById('evt-desc-short').value, 
                descLong: document.getElementById('evt-desc-long').value, 
                dateEnd: document.getElementById('evt-date-end').value 
            }; 
            if(!config.title) return Swal.fire("Error","Falta título","error"); 
            if(id) db.ref(`events/${id}/config`).update(config); 
            else db.ref('events').push({config}); 
            closeModal('modal-event-config'); 
            Swal.fire({toast:true, icon:'success', title:'Evento Guardado'}); 
        }

        function deleteCurrentEvent() { const id = document.getElementById('edit-event-id').value; Swal.fire({title:'Eliminar?', showCancelButton:true}).then(r=>{ if(r.isConfirmed){ db.ref(`events/${id}`).remove(); closeModal('modal-event-config'); } }); }
        
        // Máquina de la Suerte
        function openLuckyModal() { if(isEventClosed) return Swal.fire("Cerrado", "El sorteo ha finalizado.", "warning"); document.getElementById('modal-lucky').style.display='flex'; document.getElementById('lucky-step-1').style.display='block'; document.getElementById('lucky-step-2').style.display='none'; }
        function setLucky(n) { document.getElementById('lucky-qty').value = n; }
        
        function spinRoulette() {
            let qty = parseInt(document.getElementById('lucky-qty').value);
            if(!qty) return;
            let free = [];
            const total = parseInt(currentEventConfig.qty || 100);
            for(let i=0; i<total; i++) { if(!currentEventTickets[i] && !selected.includes(i)) free.push(i); }
            if(free.length < qty) return Swal.fire("Ups","No hay suficientes boletos libres","error");
            
            document.getElementById('lucky-step-1').style.display='none';
            document.getElementById('lucky-step-2').style.display='block';
            document.getElementById('lucky-result-text').innerText = "¡SUERTE!";
            
            tempPicks = [];
            for(let k=0; k<qty; k++) {
                let r = Math.floor(Math.random()*free.length);
                tempPicks.push(free[r]);
                free.splice(r,1);
            }
            const strips = [document.getElementById('slot-strip-1'), document.getElementById('slot-strip-2'), document.getElementById('slot-strip-3')];
            strips.forEach(strip => {
                let html = '';
                for(let j=0; j<20; j++) { html += `<div class="slot-num-item sn-${Math.floor(Math.random()*10)}">${Math.floor(Math.random()*10)}</div>`; }
                strip.innerHTML = html; strip.parentElement.classList.add('spinning'); 
            });
            setTimeout(() => { stopSlot(0); }, 1000);
            setTimeout(() => { stopSlot(1); }, 1500);
            setTimeout(() => { stopSlot(2); showFinalResult(qty, total); }, 2000);
        }

        function stopSlot(index) {
            const strips = [document.getElementById('slot-strip-1'), document.getElementById('slot-strip-2'), document.getElementById('slot-strip-3')];
            const strip = strips[index];
            strip.parentElement.classList.remove('spinning');
            let finalNum = Math.floor(Math.random()*10); 
            strip.innerHTML = `<div class="slot-num-item sn-${finalNum}" style="height:100%;">${finalNum}</div>`;
        }

        function showFinalResult(qty, total) {
            let baseNums = (total <= 100) ? 100 : total;
            let rangeSize = Math.floor(baseNums / total);
            let resultText = "";
            if(rangeSize > 1) resultText = tempPicks.map(n => `Bol #${n+1}`).join(', ');
            else resultText = tempPicks.map(n => n.toString().padStart(2,'0')).join(', ');
            document.getElementById('lucky-result-text').innerText = "TUS NÚMEROS: " + resultText;
        }

        function confirmLucky() { if(tempPicks.length > 0) { selected = [...selected, ...tempPicks]; createGrid(); updateBar(); closeModal('modal-lucky'); } }
        function resetLucky() { document.getElementById('lucky-step-2').style.display='none'; document.getElementById('lucky-step-1').style.display='block'; }
    </script>
</body>
</html>

